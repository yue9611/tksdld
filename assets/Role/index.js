System.register("chunks:///_virtual/Role.ts",["cc","./_rollupPluginModLoBabelHelpers.js","./GameConfig.ts","./GameEventType.ts","./GlobalEnum.ts","./Action3dManager.ts","./GlobalData2.ts","./Loader.ts","./GlobalPool.ts","./GameData.ts","./LevelColler.ts","./AtkBox.ts","./RoleAnimFrameEvent.ts"],(function(t){"use strict";var e,i,a,s,n,o,h,l,r,c,p,d,u,y,f,m,S,v,k,g,b,R,T,A,x,C,P,M,w,D,_,B,W,F,L,z,I,G;return{setters:[function(t){e=t.cclegacy,i=t._decorator,a=t.Mat4,s=t.SkinnedMeshRenderer,n=t.Node,o=t.v3,h=t.director,l=t.Vec4,r=t.Texture2D,c=t.SkeletalAnimation,p=t.RigidBody2D,d=t.ERigidBody2DType,u=t.v2,y=t.CircleCollider2D,f=t.Contact2DType,m=t.Color,S=t.MeshRenderer,v=t.Prefab,k=t.Vec3},function(t){g=t.applyDecoratedDescriptor,b=t.inheritsLoose,R=t.defineProperty,T=t.assertThisInitialized,A=t.initializerDefineProperty,x=t.createClass},function(t){C=t.default},function(t){P=t.EventType},function(t){M=t.GlobalEnum},function(t){w=t.default,D=t.ActionMngType},function(t){_=t.default},function(t){B=t.default},function(t){W=t.default,F=t.customPoolScript},function(t){L=t.default},function(t){z=t.default},function(t){I=t.default},function(t){G=t.RoleAnimFrameEvent}],execute:function(){var E,U,N,H,V,q,O,J,j,K,Q;e._RF.push({},"1a4972WntlLhZTDG8qT/Qeo","Role",void 0);var Z=i.ccclass,X=i.property,Y=new a;t("Role",(E=Z("Role"),U=X(s),N=X(n),H=X(n),V=X(n),E((J=g((O=function(t){function e(){for(var e,i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return e=t.call.apply(t,[this].concat(a))||this,R(T(e),"isPlayer",!1),R(T(e),"walkParticleTime",0),A(T(e),"skin",J,T(e)),R(T(e),"mat",null),R(T(e),"pass",null),R(T(e),"handleColorTransform",void 0),R(T(e),"colorTransform",void 0),R(T(e),"getGoldTime",0),R(T(e),"skinId",0),R(T(e),"scanBox",null),R(T(e),"_invicible",!1),R(T(e),"invicibleTime",0),R(T(e),"anim",null),R(T(e),"curAnimClip",void 0),R(T(e),"animFinishCb",null),R(T(e),"collCb",[]),A(T(e),"leftHand",j,T(e)),A(T(e),"rightHand",K,T(e)),R(T(e),"weaponType",M.WeaponType.none),R(T(e),"weaponId",0),R(T(e),"atkScopeType",void 0),R(T(e),"atkFan",void 0),R(T(e),"atkRect",void 0),R(T(e),"_atkRadius",0),R(T(e),"_atkRadiusSqr",0),R(T(e),"atkBox",null),R(T(e),"atkScopeNode",null),R(T(e),"disToPlayerSqr",0),A(T(e),"hatLayer",Q,T(e)),R(T(e),"moveSpeedValue",.08),R(T(e),"speed",void 0),R(T(e),"cachePos",void 0),R(T(e),"prePos",void 0),R(T(e),"faceRadian",0),R(T(e),"_targetRadian",0),R(T(e),"trunLeft",!1),R(T(e),"roleScale",C.GameRule.minScale),R(T(e),"isAlive",!0),R(T(e),"atkElapsed",0),R(T(e),"nextPortalPos",null),e}b(e,t);var i=e.prototype;return i.initSub=function(){this.initAABB(),this.initAlive(),this.initAnim(),this.initAtkBox(),this.initAtkScopeNode(),this.initCollCb(),this.initDisToPlayer(),this.initHat(),this.initInvicible(),this.initMoveSpeed(),this.initRigidNode(),this.initRoleScale(),this.initSkin(),this.initWeapon()},i.resetSub=function(){this.resetAABB(),this.resetAlive(),this.resetAnim(),this.resetAtkBox(),this.resetAtkScopeNode(),this.resetCollCb(),this.resetDirtyFlags(),this.resetDisToPlayer(),this.resetHat(),this.resetInvicible(),this.resetMoveSpeed(),this.resetRigidNode(),this.resetRoleScale(),this.resetSkin(),this.resetWeapon(),w.getMng(D.Level).stopAllActions(this.node)},i.registAllCustomUpdate=function(){this.registCustomUpdate(M.RoleState.atkReading,this.stepAtkReading),this.registCustomUpdate(M.RoleState.move,this.stepMove),this.registCustomUpdate(M.RoleState.stand,this.stepStand),this.registCustomUpdate(M.RoleState.win,this.stepWin)},i.enterCustomUpdateState=function(t){if(this._customUpdateState!=t)switch(this._customUpdateState=t,this.customUpdateMap[t]?this.customStep=this.customUpdateMap[t]:this.customStep=this.stepEmpty,t){case M.RoleState.stand:this.playAnim(M.RoleAnimType.stand);break;case M.RoleState.move:this.playAnim(M.RoleAnimType.move);break;case M.RoleState.atkReading:this.playAnim(M.RoleAnimType.atk,0);break;case M.RoleState.win:this.playAnim(M.RoleAnimType.win,0);break;case M.RoleState.deadAnimPlaying:this.playAnim(M.RoleAnimType.dead,0)}},i.setData=function(t){void 0!==t.p&&this.setPosition(t.p),void 0!==t.weaponType&&this.setWeapon(t.weaponType,t.weaponId),void 0!==t.skin&&this.setSkin(t.skin),void 0!==t.hat&&this.setHat(t.hat)},i.enterLevel=function(t){this.show(),t&&void 0!==t.weaponType&&this.setWeapon(t.weaponType,t.weaponId),t&&void 0!==t.skin&&this.setSkin(t.skin),t&&void 0!==t.hat&&this.setHat(t.hat),this.setRoleScale(C.GameRule.minScale),this.showAtkScopeNode(),this.enableAtkBox(),this.enterInvicible(3),this.enterCustomUpdateState(M.RoleState.stand),this.isAlive=!0},i.exitLevel=function(){this.disableRigidNode(),this.disableAtkBox()},i.setEulerAngles=function(t){var e=0;e="number"==typeof t?t:t.y,this.targetRadian=.017453*e,this.faceRadian=this.targetRadian,this.node.eulerAngles=o(0,e,0)},i.setMoveDir=function(t,e){if(this.canMove()){var i=.5*Math.atan2(-e,t);this.targetRadian=2*i,this.speed.x=t,this.speed.z=e,this.speed.normalize().multiplyScalar(this.moveSpeedValue*this.roleScale),this.setDirtyFlags(M.DirtyType.speed),this.enterCustomUpdateState(M.RoleState.move)}},i.setMoveAngle=function(t){this.setMoveRadian(.017453*t)},i.setMoveRadian=function(t){if(this.canMove()){t>6.2831853?t-=6.2831853:t<0&&(t+=6.2831853),this.playWalkParticle(t),this.targetRadian=t;var e=.5*t;this.node.setRotation(0,Math.sin(e),0,Math.cos(e));var i=this.moveSpeedValue*this.roleScale,a=Math.sin(2*e),s=Math.cos(2*e);this.speed.x=i*s,this.speed.z=-i*a,this.setDirtyFlags(M.DirtyType.speed),this.enterCustomUpdateState(M.RoleState.move)}},i.stopMove=function(){this.speed.x=0,this.speed.z=0,this.setDirtyFlags(M.DirtyType.speed),this.enterCustomUpdateState(M.RoleState.stand)},i.playWalkParticle=function(t){if(this.customUpdateState==M.RoleState.move){var e=this.faceRadian;if(e>6.28?e-=6.28:e<0&&(e+=6.28),Math.abs(e-t)<1.57)return;var i=h.getCurrentTime();if(i-this.walkParticleTime<500)return;this.walkParticleTime=i}var a=this.node.getPosition();this.emit(P.LevelEvent.addParticle,{n:"WalkParticle",p:a})},i.startAtk=function(){if(this.canAtk()){if(this.speed.x=0,this.speed.z=0,this.setDirtyFlags(M.DirtyType.speed),this.atkElapsed=0,this.enterCustomUpdateState(M.RoleState.atkReading),this.isPlayer||this.disToPlayerSqr<C.GameRule.enemyAudioScopeSqr)switch(this.weaponType){case M.WeaponType.katana:break;default:var t="atk"+this.weaponType+this.weaponId;this.emit(P.Common.AudioEvent.playEffect,M.AudioClip[t])}this.weaponType==M.WeaponType.trapper&&this.emit(P.LevelEvent.dropTrapper,this.Id)}},i.beHit=function(t){this.isAlive=!1,w.getMng(D.Level).stopAllActions(this.node)},i.hitSuccess=function(t){},i.getGold=function(){this.setMatGetGoldColor()},i.enterInvicible=function(t){void 0===t&&(t=3),this._invicible=!0,this.invicibleTime=t,this.addScanBox()},i.jumpInPortal=function(t,e){this.stopMove(),this.endAtkBox(),this.disableRigidNode(),this.enterCustomUpdateState(M.RoleState.jumpInPortal),this._invicible=!0;var i=w.moveTo(.5,t),a=w.scaleTo(.5,0,0,0),s=w.spawn(i,a),n=w.callFun(this.onJumpInFinish,this,e),o=w.sequence(s,n);w.getMng(D.Level).runAction(this.node,o),this.isPlayer||this.emit(P.LevelEvent.enemyJumpInPortal,this),this.nextPortalPos.set(e),this.speed.x=e.x-this.node.position.x,this.speed.z=e.z-this.node.position.z,this.speed.normalize().multiplyScalar(.8)},i.onJumpInFinish=function(t){var e=this;this.isPlayer?this.emit(P.LevelEvent.playerJumpInPortalFinish):setTimeout((function(){e.jumpOutPortal(t)}),0)},i.jumpOutPortal=function(t){this.setPosition(t);var e=this.roleScale,i=w.scaleTo(.5,e,e,e),a=w.callFun(this.onJumpOutFinish,this),s=w.sequence(i,a);w.getMng(D.Level).runAction(this.node,s),this.enterCustomUpdateState(M.RoleState.jumpOutPortal)},i.onJumpOutFinish=function(){this.enableRigidNode(),this.invicibleTime<0&&(this._invicible=!1),this.enterCustomUpdateState(M.RoleState.stand),this.isPlayer||this.emit(P.LevelEvent.enemyJumpOutPortalFinish)},i.changeSkin=function(t){t&&void 0!==t.weaponType&&(this.setWeapon(t.weaponType,t.weaponId),this.showAtkScopeNode()),t&&void 0!==t.skin&&this.setSkin(t.skin)},i.initSkin=function(){this.skin||(this.skin=this.node.getChildByName("role").getComponentInChildren(s)),this.mat=this.skin.getMaterialInstance(0),this.pass=this.mat.passes[0],this.handleColorTransform=this.pass.getHandle("colorTransform"),this.colorTransform=new l,this.pass.getUniform(this.handleColorTransform,this.colorTransform)},i.resetSkin=function(){this.colorTransform.x=0,this.colorTransform.y=1,this.applyMatUniform()},i.setSkin=function(t){var e=this;this.skinId=t,B.loadBundleRes("Role","PlayerSkin/skin"+this.skinId,(function(t){var i=new r;i.image=t,e.mat.setProperty("mainTexture",i)}))},i.setMatGetGoldColor=function(){this.getGoldTime=.15,this.colorTransform.x=1,this.applyMatUniform()},i.applyMatUniform=function(){this.pass.setUniform(this.handleColorTransform,this.colorTransform)},i.updateMatUniform=function(t){this.getGoldTime<=0||(this.getGoldTime-=t,this.getGoldTime<=0&&(this.getGoldTime=0),this.colorTransform.x=10*this.getGoldTime,this.applyMatUniform())},i.initInvicible=function(){this._invicible=!1,this.invicibleTime=0},i.resetInvicible=function(){this.removeScanBox(),this._invicible=!1,this.invicibleTime=0},i.removeScanBox=function(){this.scanBox&&(W.put(this.scanBox.node),this.scanBox=null)},i.addScanBox=function(){var t=W.get("ScanBox");t.setPosition(this.node.position),t.setScale(this.roleScale,this.roleScale,this.roleScale),this.scanBox=t[F],this.emit(P.LevelEvent.addScanBox,this.scanBox.node)},i.updateInvicible=function(t){if(!(this.invicibleTime<0)){if(this.invicibleTime-=t,this.invicibleTime<0)return this.removeScanBox(),void(this._invicible=!1);this.scanBox&&(this.scanBox.setOffset(.2*this.invicibleTime+.4),this.scanBox.node.setPosition(this.node.position))}},i.initAnim=function(){this.anim||(this.anim=this.node.getComponentInChildren(c));var t=this.anim.node.getComponent(G);t||(t=this.anim.node.addComponent(G)),t.setRole(this),this.anim.on("finished",this.onAnimFinish,this)},i.resetAnim=function(){},i.playAnim=function(t,e,i){this.curAnimClip=t;var a=this.getAnimClipName(t);this.anim.play(a),this.anim.getState(a).speed=2,this.animFinishCb=i,this.weaponType==M.WeaponType.gun&&(t==M.RoleAnimType.atk||t==M.RoleAnimType.stand?this.anim.node.eulerAngles=o(0,50,0):this.anim.node.eulerAngles=o(0,90,0))},i.getAnimClipName=function(t){switch(t){case M.RoleAnimType.dead:case M.RoleAnimType.win:return t;default:return this.weaponType==M.WeaponType.none?"attack|"+M.WeaponType.knife+"_"+t:"attack|"+this.weaponType+"_"+t}},i.onAnimFinish=function(){var t=this.animFinishCb;switch(this.animFinishCb=null,this.curAnimClip){case M.RoleAnimType.atk:this.enterCustomUpdateState(M.RoleState.stand);break;case M.RoleAnimType.win:break;case M.RoleAnimType.dead:this.enterCustomUpdateState(M.RoleState.deadAnimFinish),"Player"==this.node.name&&this.emit(P.LevelEvent.playerDeadAnimFinished)}t&&t()},i.animAtkStart=function(){this.startAtkBox(),this.processWeaponStartAtking()},i.animAtkEnd=function(){this.endAtkBox()},i.animPlayAudio=function(t){if(!t)switch(t="",this.weaponType){case M.WeaponType.captain:}t&&this.emit(P.Common.AudioEvent.playEffect,t)},i.animPlayEffect=function(){},i.animShake=function(){},i.createRigidNode=function(){if(!this.rigidNode){var t=new n(M.RigidNode.role);this.rigidNode=t;var e=t.addComponent(p),i=this.isPlayer?M.RigidGroup.player:M.RigidGroup.enmey;e.group=i,e.enabledContactListener=!0,e.bullet=!1,e.type=d.Dynamic,e.allowSleep=!1,e.gravityScale=0,e.linearDamping=0,e.angularDamping=0,e.linearVelocity=u(0,0),e.angularVelocity=0,e.fixedRotation=!0,e.awakeOnLoad=!0,this.rigid=e;var a=t.addComponent(y);a.tag=0,a.group=i,a.density=this.isPlayer?3:1,a.sensor=!1,a.friction=0,a.restitution=0,a.offset=u(0,0),a.radius=C.GameRule.roleRadius*C.GameRule.rate3to2*this.roleScale,this.isPlayer||a.on(f.POST_SOLVE,this.onConcatBegin,this),this.collider2d=a}},i.onConcatBegin=function(t,e,i){for(var a=this.collCb.length-1;a>=0;--a)this.collCb[a].cb.call(this.collCb[a].target,t,e,i)},i.initCollCb=function(){this.collCb=[]},i.resetCollCb=function(){this.collCb=[]},i.onCollCb=function(t,e){this.collCb.push({cb:t,target:e})},i.offCollCb=function(t,e){for(var i=this.collCb.length-1;i>=0;--i)if(this.collCb[i].cb==t&&this.collCb[i].target==e){this.collCb.splice(i,1);break}},i.syncModelToRigid=function(){this.getDirtyFlags(M.DirtyType.roleScale)&&(this.collider2d.radius=C.GameRule.roleRadius*C.GameRule.rate3to2*this.roleScale,this.collider2d.apply(),this.clearDirtyFlags(M.DirtyType.roleScale)),this.getDirtyFlags(M.DirtyType.speed)&&(this.clearDirtyFlags(M.DirtyType.speed),this.cacheLinearVelocity.x=this.speed.x*C.GameRule.rate3to2,this.cacheLinearVelocity.y=-this.speed.z*C.GameRule.rate3to2,this.rigid.linearVelocity=this.cacheLinearVelocity)},i.syncRigidToModel=function(){var t=this.rigidNode.position,e=C.GameRule.rate2to3;this.prePos.x=t.x*e,this.prePos.z=-t.y*e,this.node.setPosition(this.prePos),this.setDirtyFlags(M.DirtyType.pos),this.setDirtyFlags(M.DirtyType.aabb),this.updateDisToPlayer()},i.initWeapon=function(){},i.resetWeapon=function(){this.removeWeapon()},i.setWeapon=function(t,e){var i=this;this.removeWeapon(),this.weaponType=t,this.weaponId=e;var a=this.weaponType+this.weaponId;this.weaponType==M.WeaponType.trapper&&(a+=this.isPlayer?"player":"enemy");var s=W.get(a);if(s?setTimeout((function(){i.addWeapon(s)}),0):B.loadBundle("Weapon",(function(){B.loadBundleRes("Weapon","Prefab/"+a,(function(t){W.createPool(a,t,a);var e=W.get(a);i.addWeapon(e)}))}),!1,!1),this.curAnimClip){var n=this.animFinishCb;this.playAnim(this.curAnimClip,0,n)}this.updateAtkScope()},i.addWeapon=function(t){switch(this.weaponType){case M.WeaponType.claw:this.leftHand.addChild(t),t.setPosition(.003,.003,.005),t.eulerAngles=o(9.877,-259.844,231.35);var e=W.get(this.weaponType+this.weaponId);this.rightHand.addChild(e),e.setPosition(-.005,.002,.005),e.eulerAngles=o(34.532,-114.508,107.723);break;case M.WeaponType.trapper:t.setScale(5,5,5),t.setPosition(-.018,.002,.003),t.eulerAngles=o(53.642,-14.25,10.776),this.rightHand.addChild(t),t[F].offEvents();break;default:this.rightHand.addChild(t)}},i.removeWeapon=function(){W.putAllChildren(this.leftHand),W.putAllChildren(this.rightHand),this.weaponType=M.WeaponType.none,this.weaponId=0},i.updateWeapon=function(t){},i.canAtk=function(){return this._customUpdateState==M.RoleState.stand||this._customUpdateState==M.RoleState.move},i.initAtkBox=function(){this.atkScopeType=M.AtkScopeType.rect,this.atkFan={radius:1,halfRadian:1},this.atkRect={halfWidth:1,length:1},this.atkBox=new I,this.atkBox.init(),this._atkRadius=0,this._atkRadiusSqr=0},i.resetAtkBox=function(){this.atkBox.reset(),this._atkRadius=0,this._atkRadiusSqr=0},i.enableAtkBox=function(){this.weaponType!=M.WeaponType.trapper&&this.emit(P.LevelEvent.addAtkBox,this.atkBox)},i.disableAtkBox=function(){this.emit(P.LevelEvent.removeAtkBox,this.atkBox)},i.updateAtkScope=function(){if(this.weaponType!=M.WeaponType.none){var t=L.getData(M.GameDataType.WeaponAtkData,this.weaponType);if(t)switch(this.atkScopeType=t.atkScope.type,t.atkScope.type){case M.AtkScopeType.fan:this.atkFan.halfRadian=t.atkScope.halfRadian,this.atkFan.radius=t.atkScope.radius;break;case M.AtkScopeType.rect:this.atkRect.halfWidth=t.atkScope.halfWidth,this.atkRect.length=t.atkScope.length}}},i.startAtkBox=function(){if(this.weaponType!=M.WeaponType.trapper)switch(this.atkBox.visible=!0,this.atkScopeType){case M.AtkScopeType.fan:this.atkBox.setScope({atkRole:this,type:this.atkScopeType,radian:this.faceRadian,radius:this.atkFan.radius*this.roleScale,halfRadianScope:this.atkFan.halfRadian});break;case M.AtkScopeType.rect:this.atkBox.setScope({atkRole:this,type:this.atkScopeType,radian:this.faceRadian,halfWidth:this.atkRect.halfWidth*this.roleScale,length:this.atkRect.length*this.roleScale})}},i.endAtkBox=function(){this.atkBox.visible=!1},i.initAtkScopeNode=function(){},i.resetAtkScopeNode=function(){this.hideAtkScopeNode()},i.showAtkScopeNode=function(){if(this.hideAtkScopeNode(),this.weaponType!=M.WeaponType.trapper){var t,e;switch(this.atkScopeType){case M.AtkScopeType.rect:var i=W.get("AtkScopeRect");(t=i[F]).setSize(this.atkRect.halfWidth,this.atkRect.length),this.atkScopeNode=i,this.node.addChild(i);break;case M.AtkScopeType.fan:var a=W.get("AtkScopeFan");(t=a[F]).setHalfRadian(this.atkFan.halfRadian),t.setRadius(this.atkFan.radius),this.atkScopeNode=a,this.node.addChild(a)}if(0!=this.skinId){var s=L.getData(M.GameDataType.GoodsData).skin[this.skinId].color;e=new m(s)}else e=new m(196,22,0,255);t.setColor(e)}},i.hideAtkScopeNode=function(){this.atkScopeNode&&(W.put(this.atkScopeNode),this.atkScopeNode=null)},i.initDisToPlayer=function(){this.disToPlayerSqr=0},i.resetDisToPlayer=function(){this.disToPlayerSqr=0},i.updateDisToPlayer=function(){if(!this.isPlayer){var t=_.get(M.myGlobalDataType.player);if(t){var e=this.node.position.x-t.node.position.x,i=this.node.position.z-t.node.position.z;this.disToPlayerSqr=e*e+i*i}else this.disToPlayerSqr=0}},i.initHat=function(){},i.resetHat=function(){W.putAllChildren(this.hatLayer)},i.setHat=function(t){var e=this;if(this.resetHat(),0!=t){var i=W.get("hat"+t);i?this.hatLayer.addChild(i):B.loadBundle("Hat",(function(){B.loadBundleRes("Hat","Prefab/hat"+t,(function(i){W.createPool("hat"+t,i,null),B.loadBundleRes("Hat","Textures/hat"+t,(function(i){var a=W.get("hat"+t);e.hatLayer.addChild(a);var s=a.getComponent(S).getMaterialInstance(0),n=new r;n.image=i,s.setProperty("mainTexture",n)}))}),v,!1)}),!1,!1)}},i.initMoveSpeed=function(){this.speed=new k(0,0,0),this.cachePos=new k,this.prePos=new k,this.faceRadian=0,this._targetRadian=0,this.setDirtyFlags(M.DirtyType.speed)},i.resetMoveSpeed=function(){this.speed.x=this.speed.y=this.speed.z=0,this.faceRadian=0,this._targetRadian=0,this.setDirtyFlags(M.DirtyType.speed)},i.setSpeedValue=function(t){t==this.moveSpeedValue||t<0||(this.moveSpeedValue=t,this.speed.normalize().multiplyScalar(this.moveSpeedValue*this.roleScale),this.setDirtyFlags(M.DirtyType.speed))},i.canMove=function(){return this._customUpdateState==M.RoleState.stand||this._customUpdateState==M.RoleState.move},i.initRoleScale=function(){this.roleScale=C.GameRule.minScale,this.node.setScale(this.roleScale,this.roleScale,this.roleScale),this.setDirtyFlags(M.DirtyType.roleScale),this.setDirtyFlags(M.DirtyType.aabb)},i.resetRoleScale=function(){this.roleScale=C.GameRule.minScale,this.node.setScale(this.roleScale,this.roleScale,this.roleScale),this.setDirtyFlags(M.DirtyType.roleScale),this.setDirtyFlags(M.DirtyType.aabb),w.getMng(D.Level).stopAllActions(this.node)},i.setRoleScale=function(t){this.roleScale!=t&&(w.getMng(D.Level).stopAllActions(this.node),this.roleScale=t,this.node.setScale(this.roleScale,this.roleScale,this.roleScale),this.scanBox&&this.scanBox.node.setScale(this.roleScale,this.roleScale,this.roleScale),this.setDirtyFlags(M.DirtyType.roleScale),this.setDirtyFlags(M.DirtyType.aabb))},i.growUpRoleScale=function(t){t?this.roleScale=t:this.roleScale+=C.GameRule.scaleStep,this.setDirtyFlags(M.DirtyType.roleScale),this.setDirtyFlags(M.DirtyType.aabb);var e=this.roleScale,i=w.scaleTo(.3,e,e,e);w.getMng(D.Level).runAction(this.node,i)},i.initAlive=function(){this.isAlive=!0},i.resetAlive=function(){this.isAlive=!0},i.processDirty=function(){if(this.aabbDirty){this.aabbDirty=!1;var t=this.roleScale,e=this.node.position;this._aabb.xMin=this.minVert.x*t+e.x,this._aabb.xMax=this.maxVert.x*t+e.x,this._aabb.xScope=.5*(this._aabb.xMax-this._aabb.xMin),this._aabb.yMin=this.minVert.y*t+e.y,this._aabb.yMax=this.maxVert.y*t+e.y,this._aabb.yScope=this._aabb.yMax-this._aabb.yMin,this._aabb.zMin=this.minVert.z*t+e.z,this._aabb.zMax=this.maxVert.z*t+e.z,this._aabb.zScope=.5*(this._aabb.zMax-this._aabb.zMin),this._aabb.xCenter=this._aabb.xMin+this._aabb.xScope,this._aabb.yCenter=this._aabb.yMin+.5*this._aabb.yScope,this._aabb.zCenter=this._aabb.zMin+this._aabb.zScope,this._center.x=this._aabb.xCenter,this._center.y=this._aabb.yCenter,this._center.z=this._aabb.zCenter}},i.stepStand=function(t){this.updateWeapon(t),this.updateMatUniform(t),this.updateInvicible(t)},i.stepMove=function(t){if(this.faceRadian!==this.targetRadian){var e=Math.PI*t*3;e>Math.abs(this.targetRadian-this.faceRadian)?this.faceRadian=this.targetRadian:(this.trunLeft||(e=-e),this.faceRadian+=e);var i=.5*this.faceRadian;this.node.setRotation(0,Math.sin(i),0,Math.cos(i))}this.updateWeapon(t),this.updateInvicible(t),this.updateMatUniform(t)},i.stepAtkReading=function(t){this.updateInvicible(t),this.updateMatUniform(t)},i.processWeaponStartAtking=function(){switch(this.weaponType){case M.WeaponType.katana:var t="atk"+this.weaponType+this.weaponId;this.emit(P.Common.AudioEvent.playEffect,M.AudioClip[t]);break;case M.WeaponType.captain:this.isPlayer&&_.get(M.Common.GlobalDataType.levelCamera).shock({duration:.1,offset:o(0,.3,0)});var e=o(2.44,0,0);this.node.getWorldMatrix(Y),k.transformMat4(e,e,Y),e.y+=.1,this.emit(P.LevelEvent.addParticle,{n:"ChongJiBo",p:e,s:this.roleScale}),this.emit(P.Common.SDKEvent.vibrateShort);break;case M.WeaponType.gun:var i=o(1.52,1.4,.44);2==this.weaponId&&(i=o(1.92,1.35,.44)),this.node.getWorldMatrix(Y),k.transformMat4(i,i,Y),this.emit(P.LevelEvent.addParticle,{n:"BoomParticle",p:i,s:.5*this.roleScale});break;case M.WeaponType.hunter:if(this.isPlayer){var a=o();a.x=.3*Math.cos(this.faceRadian),a.z=.3*-Math.sin(this.faceRadian),_.get(M.Common.GlobalDataType.levelCamera).shock({duration:.1,offset:a})}var s=o(.96,1.32,.31);this.node.getWorldMatrix(Y),k.transformMat4(s,s,Y),this.emit(P.LevelEvent.addBoomEffect,{p:s,s:this.roleScale}),4!=this.weaponId&&this.emit(P.LevelEvent.addParticle,{n:"BoomParticle",p:s,s:this.roleScale});break;case M.WeaponType.trapper:var n=new k(0,0,0),h=this.faceRadian,l=5*this.roleScale;n.x=Math.cos(h)*l*.7,n.z=-Math.sin(h)*l*.7,this.emit(P.LevelEvent.addTrapper,{role:this,speed:n}),h=this.faceRadian+.3,n.x=Math.cos(h)*l,n.z=-Math.sin(h)*l,this.emit(P.LevelEvent.addTrapper,{role:this,speed:n}),h=this.faceRadian-.3,n.x=Math.cos(h)*l,n.z=-Math.sin(h)*l,this.emit(P.LevelEvent.addTrapper,{role:this,speed:n})}},i.stepWin=function(t){this.updateInvicible(t),this.updateMatUniform(t)},i.stepPortal=function(t){this.cachePos.x+=this.speed.x*t,this.cachePos.z+=this.speed.z*t,Math.abs(this.cachePos.x-this.nextPortalPos.x)<.1&&Math.abs(this.cachePos.z-this.nextPortalPos.z)<.1?this.jumpOutPortal(this.nextPortalPos):this.node.setPosition(this.cachePos)},x(e,[{key:"invicible",get:function(){return this._invicible}},{key:"atkRadius",get:function(){return this._atkRadius&&!this.getDirtyFlags(M.DirtyType.roleScale)||(this.atkScopeType===M.AtkScopeType.fan?this._atkRadius=this.atkFan.radius*this.roleScale:this._atkRadius=this.atkRect.length*this.roleScale),this._atkRadius}},{key:"atkRadiusSqr",get:function(){return this._atkRadius&&!this.getDirtyFlags(M.DirtyType.roleScale)||(this.atkScopeType===M.AtkScopeType.fan?this._atkRadiusSqr=this.atkFan.radius*this.roleScale:this._atkRadiusSqr=this.atkRect.length*this.roleScale,this._atkRadiusSqr=this._atkRadiusSqr*this._atkRadiusSqr+1),this._atkRadiusSqr}},{key:"targetRadian",get:function(){return this._targetRadian},set:function(t){this._targetRadian=t;var e=Math.PI;this._targetRadian<0&&(this._targetRadian+=2*e),this.faceRadian>2*e?this.faceRadian-=2*e:this.faceRadian<0&&(this.faceRadian+=2*e);var i=this._targetRadian-this.faceRadian;i>e?(this.trunLeft=!1,this.faceRadian+=2*e):i>0?this.trunLeft=!0:i<-e?(this.trunLeft=!0,this._targetRadian+=2*e):i<0&&(this.trunLeft=!1)}}]),e}(z)).prototype,"skin",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),j=g(O.prototype,"leftHand",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),K=g(O.prototype,"rightHand",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Q=g(O.prototype,"hatLayer",[V],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=O))||q));e._RF.pop()}}}));

System.register("chunks:///_virtual/ScanBox.ts",["cc","./_rollupPluginModLoBabelHelpers.js","./yyComponent.ts"],(function(t){"use strict";var i,n,e,s,a,o,r,f;return{setters:[function(t){i=t.cclegacy,n=t._decorator,e=t.MeshRenderer,s=t.Vec4},function(t){a=t.inheritsLoose,o=t.defineProperty,r=t.assertThisInitialized},function(t){f=t.default}],execute:function(){var l;i._RF.push({},"387ae+C+5dIXauNa7uFo+Dl","ScanBox",void 0);var c=n.ccclass;n.property,t("ScanBox",c("ScanBox")(l=function(t){function i(){for(var i,n=arguments.length,e=new Array(n),s=0;s<n;s++)e[s]=arguments[s];return i=t.call.apply(t,[this].concat(e))||this,o(r(i),"mat",null),o(r(i),"pass",null),o(r(i),"handle",void 0),o(r(i),"tilingOffset",void 0),i}a(i,t);var n=i.prototype;return n.initSub=function(){this.initMat()},n.resetSub=function(){this.resetMat()},n.initMat=function(){this.mat=this.node.children[0].getComponent(e).getMaterialInstance(0),this.pass=this.mat.passes[0],this.handle=this.pass.getHandle("tilingOffset"),this.tilingOffset=new s,this.pass.getUniform(this.handle,this.tilingOffset)},n.resetMat=function(){this.tilingOffset.y=1,this.applyMatUniform()},n.applyMatUniform=function(){this.pass.setUniform(this.handle,this.tilingOffset)},n.setOffset=function(t){this.tilingOffset.y=t,this.applyMatUniform()},i}(f))||l);i._RF.pop()}}}));

System.register("chunks:///_virtual/Enemy.ts",["cc","./_rollupPluginModLoBabelHelpers.js","./GameEventType.ts","./GlobalEnum.ts","./Action3dManager.ts","./Role.ts"],(function(e){"use strict";var t,i,n,s,o,a,l,c;return{setters:[function(e){t=e.cclegacy,i=e._decorator},function(e){n=e.inheritsLoose},function(e){s=e.EventType},function(e){o=e.GlobalEnum},function(e){a=e.default,l=e.ActionMngType},function(e){c=e.Role}],execute:function(){var r;t._RF.push({},"38ed9fZzPxKhqXeEcvimGGr","Enemy",void 0);var h=i.ccclass;i.property,e("Enemy",h("Enemy")(r=function(e){function t(){return e.apply(this,arguments)||this}n(t,e);var i=t.prototype;return i.beHit=function(e){switch(a.getMng(l.Level).stopAllActions(this.node),this.exitLevel(),this.isAlive=!1,e.weaponType){case o.WeaponType.captain:case o.WeaponType.gun:case o.WeaponType.hunter:var t=e.node.position,i=Math.atan2(t.z-this.node.position.z,this.node.position.x-t.x);this.emit(s.LevelEvent.addDeadBody,{p:this.node.position,radian:i,scale:this.roleScale,isPlayer:!1,skin:this.skinId,anim:"RoleDeadFlyAnim"});break;default:this.emit(s.LevelEvent.addDeadBody,{p:this.node.position,radian:this.faceRadian,scale:this.roleScale,isPlayer:!1,skin:this.skinId})}this.emit(s.LevelEvent.enemyDead,this)},i.hitSuccess=function(e){switch(e.collerType){case o.CollerType.barrier:break;case o.CollerType.role:this.growUpRoleScale()}},i.onAnimFinish=function(){var e=this.animFinishCb;switch(this.animFinishCb=null,e&&e(),this.curAnimClip){case o.RoleAnimType.atk:this.enterCustomUpdateState(o.RoleState.move),this.emit(s.LevelEvent.enemyAtkFinish,this)}},t}(c))||r);t._RF.pop()}}}));

System.register("chunks:///_virtual/Weapon.ts",["cc","./_rollupPluginModLoBabelHelpers.js","./yyComponent.ts"],(function(t){"use strict";var e,n,i,o,r,a,s,u,p,c;return{setters:[function(t){e=t.cclegacy,n=t._decorator,i=t.Node,o=t.Color},function(t){r=t.applyDecoratedDescriptor,a=t.inheritsLoose,s=t.initializerDefineProperty,u=t.assertThisInitialized,p=t.defineProperty},function(t){c=t.default}],execute:function(){var l,d,f,k,h,g,S,m,v;e._RF.push({},"687167lSzlDZbE21hkLtuOM","Weapon",void 0);var b,y=n.ccclass,C=n.property;t("Weapon",(l=y("Weapon"),d=C(i),f=C(i),k=C({type:o,tooltip:"武器拖尾颜色"}),l((S=r((g=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i))||this,s(u(e),"topNode",S,u(e)),s(u(e),"bottomNode",m,u(e)),p(u(e),"cachePosTop",void 0),p(u(e),"cachePosBottom",void 0),s(u(e),"streakColor",v,u(e)),e}a(e,t);var n=e.prototype;return n.initSub=function(){this.initStreak()},n.resetSub=function(){this.resetStreak()},n.registAllCustomUpdate=function(){this.registCustomUpdate(b.atking,this.stepAtking),this.registCustomUpdate(b.end,this.stepAtkEnd),this.registCustomUpdate(b.enter,this.stepAtkEnter),this.registCustomUpdate(b.moving,this.stepMoving),this.registCustomUpdate(b.reading,this.stepAtkReading)},n.enterLevel=function(){this.enableStreak()},n.exitLevel=function(){this.disableStreak()},n.atkReading=function(){this.enterCustomUpdateState(b.reading)},n.atkEnter=function(){this.enterCustomUpdateState(b.enter),this.playStreak()},n.atking=function(){this.enterCustomUpdateState(b.atking)},n.atkEnd=function(){this.enterCustomUpdateState(b.end)},n.atkFinish=function(){this.enterCustomUpdateState(b.moving)},n.initStreak=function(){},n.resetStreak=function(){},n.playStreak=function(){},n.moveStreak=function(){},n.updateStreak=function(t){},n.enableStreak=function(){},n.disableStreak=function(){},n.stepAtkReading=function(t){},n.stepAtkEnter=function(t){this.moveStreak(),this.updateStreak(t)},n.stepAtking=function(t){this.moveStreak(),this.updateStreak(t)},n.stepAtkEnd=function(t){this.updateStreak(t)},n.stepMoving=function(t){this.updateStreak(t)},e}(c)).prototype,"topNode",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m=r(g.prototype,"bottomNode",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=r(g.prototype,"streakColor",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new o}}),h=g))||h));!function(t){t[t.reading=0]="reading",t[t.enter=1]="enter",t[t.atking=2]="atking",t[t.end=3]="end",t[t.moving=4]="moving"}(b||(b={})),e._RF.pop()}}}));

System.register("chunks:///_virtual/AtkScopeFan.ts",["cc","./_rollupPluginModLoBabelHelpers.js","./GameConfig.ts","./yyComponent.ts"],(function(e){"use strict";var t,s,i,n,a,r,h,o,c,u,l,m,p;return{setters:[function(e){t=e.cclegacy,s=e._decorator,i=e.MeshRenderer,n=e.utils,a=e.Vec4,r=e.Mesh},function(e){h=e.applyDecoratedDescriptor,o=e.inheritsLoose,c=e.initializerDefineProperty,u=e.assertThisInitialized,l=e.defineProperty},function(e){m=e.default},function(e){p=e.default}],execute:function(){var f,d,y,R,v;t._RF.push({},"73e95C9HqxDU4j/Z56IdS1a","AtkScopeFan",void 0);var D=s.ccclass,M=s.property;e("AtkScopeFan",(f=D("AtkScopeFan"),d=M(i),f((v=h((R=function(e){function t(){for(var t,s=arguments.length,i=new Array(s),n=0;n<s;n++)i[n]=arguments[n];return t=e.call.apply(e,[this].concat(i))||this,c(u(t),"meshRender",v,u(t)),l(u(t),"meshData",null),l(u(t),"mesh",null),t}o(t,e);var s=t.prototype;return s.init=function(){this.initMesh()},s.setColor=function(e){var t=e.r/255,s=e.g/255,i=e.b/255,a=e.a/255;this.meshData.colors=[t,s,i,a,t,s,i,a,t,s,i,a,t,s,i,a],n.createMesh(this.meshData,this.mesh),this.meshRender.mesh=this.mesh},s.setRadius=function(e){this.meshData.positions=[-e,0,-e,-e,0,e,e,0,e,e,0,-e],n.createMesh(this.meshData,this.mesh),this.meshRender.mesh=this.mesh},s.setHalfRadian=function(e){var t=this.meshRender.getMaterialInstance(0).passes[0],s=t.getHandle("scope"),i=new a;t.getUniform(s,i),i.x=2*e,t.setUniform(s,i)},s.initMesh=function(){this.createMesh()},s.createMesh=function(){var e=m.GameRule.atkScopeFan.radius;this.meshData={positions:[-e,0,-e,-e,0,e,e,0,e,e,0,-e],indices:[0,1,2,0,2,3],uvs:[0,0,0,1,1,1,1,0],colors:[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]},this.mesh=new r,this.mesh=n.createMesh(this.meshData),this.meshRender.mesh=this.mesh},t}(p)).prototype,"meshRender",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=R))||y));t._RF.pop()}}}));

System.register("chunks:///_virtual/AtkScopeRect.ts",["cc","./_rollupPluginModLoBabelHelpers.js","./GameConfig.ts","./yyComponent.ts"],(function(e){"use strict";var t,s,i,n,r,h,a,o,c,l,u,m;return{setters:[function(e){t=e.cclegacy,s=e._decorator,i=e.MeshRenderer,n=e.utils,r=e.Mesh},function(e){h=e.applyDecoratedDescriptor,a=e.inheritsLoose,o=e.initializerDefineProperty,c=e.assertThisInitialized,l=e.defineProperty},function(e){u=e.default},function(e){m=e.default}],execute:function(){var p,f,d,R,y;t._RF.push({},"78a2cBtnppAwbxlWNK9PDbi","AtkScopeRect",void 0);var D=s.ccclass,v=s.property;e("AtkScopeRect",(p=D("AtkScopeRect"),f=v(i),p((y=h((R=function(e){function t(){for(var t,s=arguments.length,i=new Array(s),n=0;n<s;n++)i[n]=arguments[n];return t=e.call.apply(e,[this].concat(i))||this,o(c(t),"meshRender",y,c(t)),l(c(t),"meshData",null),l(c(t),"mesh",null),t}a(t,e);var s=t.prototype;return s.init=function(){this.initMesh()},s.setColor=function(e){var t=e.r/255,s=e.g/255,i=e.b/255,r=e.a/255;this.meshData.colors=[t,s,i,r,t,s,i,r,t,s,i,r,t,s,i,r],n.createMesh(this.meshData,this.mesh),this.meshRender.mesh=this.mesh},s.setSize=function(e,t){this.meshData.positions=[0,0,-e,0,0,e,t,0,e,t,0,-e],n.createMesh(this.meshData,this.mesh),this.meshRender.mesh=this.mesh},s.initMesh=function(){this.createMesh()},s.createMesh=function(){var e=u.GameRule.atkScopeRect.halfWidth,t=u.GameRule.atkScopeRect.length;this.meshData={positions:[0,0,-e,0,0,e,t,0,e,t,0,-e],indices:[0,1,2,0,2,3],uvs:[0,0,0,1,1,1,1,0],colors:[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]},this.mesh=new r,this.mesh=n.createMesh(this.meshData),this.meshRender.mesh=this.mesh},t}(m)).prototype,"meshRender",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),d=R))||d));t._RF.pop()}}}));

System.register("chunks:///_virtual/ShopRole.ts",["cc","./_rollupPluginModLoBabelHelpers.js","./GameEventType.ts","./GlobalEnum.ts","./yyComponent.ts","./PlayerData.ts","./Loader.ts","./GlobalPool.ts"],(function(e){"use strict";var t,n,i,a,o,r,s,h,l,d,u,p,c,f,y,v,m,g,I,k,T,w;return{setters:[function(e){t=e.cclegacy,n=e._decorator,i=e.SkinnedMeshRenderer,a=e.Node,o=e.Texture2D,r=e.MeshRenderer,s=e.Prefab,h=e.Layers,l=e.UIMeshRenderer,d=e.v3},function(e){u=e.applyDecoratedDescriptor,p=e.inheritsLoose,c=e.initializerDefineProperty,f=e.assertThisInitialized,y=e.defineProperty},function(e){v=e.EventType},function(e){m=e.GlobalEnum},function(e){g=e.default},function(e){I=e.default},function(e){k=e.default},function(e){T=e.default,w=e.customPoolScript}],execute:function(){var H,S,b,P,W,U,C,E,L,R,D;t._RF.push({},"88860uNwqhMkoGpLyqpP3bL","ShopRole",void 0);var x=n.ccclass,A=n.property;e("ShopRole",(H=x("ShopRole"),S=A(i),b=A(a),P=A(a),W=A(a),H((E=u((C=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return t=e.call.apply(e,[this].concat(i))||this,c(f(t),"skin",E,f(t)),y(f(t),"mat",null),y(f(t),"skinId",null),c(f(t),"leftHand",L,f(t)),c(f(t),"rightHand",R,f(t)),y(f(t),"weaponType",m.WeaponType.none),y(f(t),"weaponId",0),c(f(t),"hatLayer",D,f(t)),y(f(t),"hatId",null),t}p(t,e);var n=t.prototype;return n.init=function(){this.initSub(),this.onEvents(),this.updateState()},n.initSub=function(){this.initHat(),this.initSkin(),this.initWeapon()},n.resetSub=function(){this.resetSkin()},n.onEvents=function(){this.on(v.LevelEvent.setPreview,this.setPreview,this),this.on(v.Common.UIEvent.exited,this.onExitUI,this)},n.reuse=function(){this.reset(),this.onEvents(),console.log("shoprole又注册了事件"),this.updateState()},n.unuse=function(){this.reset(),this.offEvents(),console.log("shoprole注销事件")},n.updateState=function(){var e=I.getData("gameData.PlayerSkin.cur");this.setSkin(e);var t=I.getData("gameData.WeaponSkin.cur");this.setWeapon(t.type,t.id);var n=I.getData("gameData.HatSkin.cur");this.setHat(n)},n.setSkin=function(e){var t=this;void 0===e&&(e=0),this.skinId!==e&&(this.skinId=e,k.loadBundleRes("Role","PlayerSkin/skin"+this.skinId,(function(e){var n=new o;n.image=e,t.mat.setProperty("mainTexture",n)})))},n.removeSkin=function(){this.setSkin(0)},n.setWeapon=function(e,t){var n=this;if(void 0===e&&(e=m.WeaponType.katana,t=1),(this.weaponType!==e||this.weaponId!==t)&&(this.removeWeapon(),this.weaponType=e,this.weaponId=t,this.weaponType!=m.WeaponType.none)){var i=this.weaponType+this.weaponId;this.weaponType==m.WeaponType.trapper&&(i+="player");var a=T.get(i);a?this.addWeapon(a):k.loadBundle("Weapon",(function(){k.loadBundleRes("Weapon","Prefab/"+i,(function(e){T.createPool(i,e,i);var t=T.get(i);n.addWeapon(t)}))}),!1,!1)}},n.removeWeapon=function(){for(var e=this.leftHand.children.length-1;e>=0;--e)this.removeFromUI(this.leftHand.children[e]);for(var t=this.rightHand.children.length-1;t>=0;--t)this.removeFromUI(this.rightHand.children[t]);T.putAllChildren(this.leftHand),T.putAllChildren(this.rightHand),this.weaponType=m.WeaponType.none,this.weaponId=0},n.setHat=function(e){var t=this;if(void 0===e&&(e=0),this.hatId!==e&&(this.resetHat(),this.hatId=e,0!=e)){var n=T.get("hat"+e);n?(this.addToUI(n),this.hatLayer.addChild(n)):k.loadBundle("Hat",(function(){k.loadBundleRes("Hat","Prefab/hat"+e,(function(n){T.createPool("hat"+e,n,null),k.loadBundleRes("Hat","Textures/hat"+e,(function(n){var i=T.get("hat"+e);t.addToUI(i),t.hatLayer.addChild(i);var a=i.getComponent(r).getMaterialInstance(0),s=new o;s.image=n,a.setProperty("mainTexture",s)}))}),s,!1)}),!1,!1)}},n.removeHat=function(){for(var e=this.hatLayer.children.length-1;e>=0;--e)this.removeFromUI(this.hatLayer.children[e]);T.putAllChildren(this.hatLayer),this.hatId=null},n.addToUI=function(e){e.layer=h.Enum.UI_2D,e.addComponent(l)},n.removeFromUI=function(e){e.layer=h.Enum.DEFAULT,e.removeComponent(l)},n.initSkin=function(){this.skin||(this.skin=this.node.getComponentInChildren(i)),this.mat=this.skin.getMaterialInstance(0)},n.resetSkin=function(){},n.initWeapon=function(){},n.resetWeapon=function(){this.removeWeapon()},n.addWeapon=function(e){switch(this.weaponType){case m.WeaponType.claw:this.addToUI(e),this.leftHand.addChild(e),e.setPosition(.003,.003,.005),e.eulerAngles=d(9.877,-259.844,231.35);var t=T.get(this.weaponType+this.weaponId);this.addToUI(t),this.rightHand.addChild(t),t.setPosition(-.005,.002,.005),t.eulerAngles=d(34.532,-114.508,107.723);break;case m.WeaponType.trapper:this.addToUI(e);e.setScale(5,5,5),e.setPosition(-.018,.002,.003),e.eulerAngles=d(53.642,-14.25,10.776),this.rightHand.addChild(e),e[w].offEvents();break;default:this.addToUI(e),this.rightHand.addChild(e)}},n.initHat=function(){},n.resetHat=function(){this.removeHat()},n.setPreview=function(e){switch(e.type){case"skin":this.setSkin(e.data.id);break;case"hat":this.setHat(e.data.id);break;default:this.setWeapon(e.data.type,e.data.id)}},n.onExitUI=function(e){e==m.UI.shop&&this.updateState()},t}(g)).prototype,"skin",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=u(C.prototype,"leftHand",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),R=u(C.prototype,"rightHand",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=u(C.prototype,"hatLayer",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),U=C))||U));t._RF.pop()}}}));

System.register("chunks:///_virtual/Player.ts",["cc","./_rollupPluginModLoBabelHelpers.js","./GameConfig.ts","./GameEventType.ts","./GlobalEnum.ts","./Action3dManager.ts","./Role.ts"],(function(e){"use strict";var t,i,o,n,s,l,a,r,c,h,d,p;return{setters:[function(e){t=e.cclegacy,i=e._decorator,o=e.v3},function(e){n=e.inheritsLoose,s=e.defineProperty,l=e.assertThisInitialized},function(e){a=e.default},function(e){r=e.EventType},function(e){c=e.GlobalEnum},function(e){h=e.default,d=e.ActionMngType},function(e){p=e.Role}],execute:function(){var u;t._RF.push({},"8ea7369NKJEp7aJ6rBjLvK+","Player",void 0);var v=i.ccclass;i.property,e("Player",v("Player")(u=function(e){function t(){for(var t,i=arguments.length,o=new Array(i),n=0;n<i;n++)o[n]=arguments[n];return t=e.call.apply(e,[this].concat(o))||this,s(l(t),"isPlayer",!0),t}n(t,e);var i=t.prototype;return i.onEvents=function(){this.on(r.LevelEvent.moveJoy,this.onMoveJoy,this),this.on(r.LevelEvent.stopJoy,this.onStopJoy,this)},i.beHit=function(e){switch(h.getMng(d.Level).stopAllActions(this.node),e.weaponType){case c.WeaponType.captain:case c.WeaponType.gun:case c.WeaponType.hunter:var t=e.node.position,i=Math.atan2(t.z-this.node.position.z,this.node.position.x-t.x);this.emit(r.LevelEvent.killPlayer,{p:this.node.position,radian:i,scale:this.roleScale,isPlayer:!0,skin:this.skinId,anim:"RoleDeadFlyAnim"});break;default:this.emit(r.LevelEvent.killPlayer,{p:this.node.position,radian:this.faceRadian,scale:this.roleScale,isPlayer:!0,skin:this.skinId})}this.disableAtkBox(),this.node.active=!1,this.isAlive=!1,this.collider2d.density=1e3,this.collider2d.apply()},i.hitSuccess=function(e){switch(e.collerType){case c.CollerType.barrier:break;case c.CollerType.role:this.growUpRoleScale(),this.emit(r.LevelEvent.playerKillEnemy),this.emit(r.LevelEvent.updateRoleScale,this.roleScale)}},i.resurgence=function(e){this.show(),this.node.setPosition(e);var t=a.GameRule.rate3to2;this.rigidNode.setPosition(e.x*t,-e.z*t,0),this.rigidNode.setScale(this.roleScale,this.roleScale,this.roleScale),this.showAtkScopeNode(),this.enableAtkBox(),this.enterInvicible(3),this.enterCustomUpdateState(c.RoleState.stand),this.isAlive=!0,this.collider2d.density=1,this.collider2d.apply()},i.getGold=function(){this.setMatGetGoldColor(),this.emit(r.LevelEvent.getGold),this.emit(r.Common.AudioEvent.playEffect,c.AudioClip.gold)},i.playWinAnim=function(){this.resetInvicible(),this.stopMove(),this.node.eulerAngles=o(0,-90,0),this.roleScale=a.GameRule.minScale;var e=this.roleScale,t=h.scaleTo(1,e,e,e);h.getMng(d.Level).runAction(this.node,t),this.enterCustomUpdateState(c.RoleState.win),this.hideAtkScopeNode()},i.onMoveJoy=function(e){var t=Math.atan2(e.y,e.x)+0;this.setMoveRadian(t)},i.onStopJoy=function(){this.startAtk()},t}(p))||u);t._RF.pop()}}}));

System.register("chunks:///_virtual/RoleDeadAnim.ts",["cc","./_rollupPluginModLoBabelHelpers.js","./GameEventType.ts","./yyComponent.ts","./Loader.ts"],(function(i){"use strict";var t,n,e,s,o,r,a,l,h,m,c,f;return{setters:[function(i){t=i.cclegacy,n=i._decorator,e=i.SkeletalAnimation,s=i.SkinnedMeshRenderer,o=i.Vec4,r=i.Texture2D},function(i){a=i.inheritsLoose,l=i.defineProperty,h=i.assertThisInitialized},function(i){m=i.EventType},function(i){c=i.default},function(i){f=i.default}],execute:function(){var u;t._RF.push({},"abe8f7Oo+FMDbVf0B5LjsMk","RoleDeadAnim",void 0);var d=n.ccclass;n.property,i("RoleDeadAnim",d("RoleDeadAnim")(u=function(i){function t(){for(var t,n=arguments.length,e=new Array(n),s=0;s<n;s++)e[s]=arguments[s];return t=i.call.apply(i,[this].concat(e))||this,l(h(t),"anim",null),l(h(t),"isPlayer",!1),l(h(t),"skin",null),l(h(t),"mat",null),l(h(t),"pass",null),l(h(t),"handleColorTransform",void 0),l(h(t),"colorTransform",void 0),l(h(t),"beHitTime",0),t}a(t,i);var n=t.prototype;return n.init=function(){this.initAnim(),this.initSkin()},n.reset=function(){this.resetSkin()},n.initAnim=function(){this.anim=this.node.getComponentInChildren(e),this.anim.on("finished",this.onAnimFinish,this)},n.play=function(i){var t=i.scale;this.node.setScale(t,t,t),this.node.setPosition(i.p),this.node.setRotation(0,Math.sin(.5*i.radian),0,Math.cos(.5*i.radian)),this.isPlayer=!!i.isPlayer,this.anim.play(),this.setMatBeHitColor(),this.setSkin(i.skin)},n.onAnimFinish=function(){this.isPlayer&&this.emit(m.LevelEvent.playerDeadAnimFinished)},n.initSkin=function(){this.skin||(this.skin=this.node.getComponentInChildren(s)),this.mat=this.skin.getMaterialInstance(0),this.pass=this.mat.passes[0],this.handleColorTransform=this.pass.getHandle("colorTransform"),this.colorTransform=new o,this.pass.getUniform(this.handleColorTransform,this.colorTransform)},n.resetSkin=function(){this.colorTransform.x=0,this.colorTransform.y=1,this.applyMatUniform()},n.setSkin=function(i){var t=this;f.loadBundleRes("Role","PlayerSkin/skin"+i,(function(i){var n=new r;n.image=i,t.mat.setProperty("mainTexture",n)}))},n.setMatBeHitColor=function(){this.beHitTime=.5,this.colorTransform.x=2,this.applyMatUniform()},n.applyMatUniform=function(){this.pass.setUniform(this.handleColorTransform,this.colorTransform)},n.customUpdate=function(i){this.beHitTime<=0||(this.beHitTime-=i,this.beHitTime<=0&&(this.beHitTime=0,this.emit(m.LevelEvent.deadAnimFinish,this)),this.colorTransform.x=10*this.beHitTime,this.applyMatUniform())},t}(c))||u);t._RF.pop()}}}));

System.register("chunks:///_virtual/WeaponStreak.ts",["cc","./_rollupPluginModLoBabelHelpers.js","./yyComponent.ts"],(function(t){"use strict";var s,o,e,i,h,r,a,n,l,m,c,p;return{setters:[function(t){s=t.cclegacy,o=t._decorator,e=t.Color,i=t.utils,h=t.MeshRenderer,r=t.Vec3},function(t){a=t.applyDecoratedDescriptor,n=t.inheritsLoose,l=t.defineProperty,m=t.assertThisInitialized,c=t.initializerDefineProperty},function(t){p=t.default}],execute:function(){var u,D,f,v,b,y,d,P,V;s._RF.push({},"df78aDL9/tGyZ7AyxaacdAk","WeaponStreak",void 0);var z=o.ccclass,x=o.property;t("default",(u=z("WeaponStreak"),D=x({type:e,tooltip:"拖尾颜色"}),f=x({tooltip:"顶点细分等级，值越大拖尾越平滑"}),v=x({tooltip:"拖尾的柔软度，值越大尾巴越柔软，拉的越长"}),u((d=a((y=function(t){function s(){for(var s,o=arguments.length,e=new Array(o),i=0;i<o;i++)e[i]=arguments[i];return s=t.call.apply(t,[this].concat(e))||this,l(m(s),"meshRender",null),l(m(s),"mesh",null),l(m(s),"meshData",null),l(m(s),"topVerts",void 0),l(m(s),"bottomVerts",void 0),c(m(s),"color",d,m(s)),c(m(s),"level",P,m(s)),c(m(s),"soft",V,m(s)),l(m(s),"topPos",null),l(m(s),"bottomPos",null),s}n(s,t);var o=s.prototype;return o.init=function(t){this.initMesh(),void 0!==t&&this.setData(t)},o.setData=function(t){if(void 0!==t.soft&&(this.soft=t.soft),void 0!==t.color){this.color.set(t.color);for(var s=1/255,o=t.color.r*s,e=t.color.g*s,h=t.color.b*s,r=t.color.a*s,a=0,n=2*this.level,l=0;l<n;++l)this.meshData.colors[a++]=o,this.meshData.colors[a++]=e,this.meshData.colors[a++]=h,this.meshData.colors[a++]=r;i.createMesh(this.meshData,this.mesh),this.meshRender.mesh=this.mesh}},o.play=function(t){this.topPos.set(t.topPos),this.bottomPos.set(t.bottomPos);for(var s=0,o=0;o<=this.level;++o)this.topVerts[o].set(t.topPos),this.bottomVerts[o].set(t.bottomPos),this.meshData.positions[s++]=t.topPos.x,this.meshData.positions[s++]=t.topPos.y,this.meshData.positions[s++]=t.topPos.z,this.meshData.positions[s++]=t.bottomPos.x,this.meshData.positions[s++]=t.bottomPos.y,this.meshData.positions[s++]=t.bottomPos.z;if(void 0!==t.color)for(var e=1/255,h=t.color.r*e,r=t.color.g*e,a=t.color.b*e,n=t.color.a*e,l=0,m=2*this.level,c=0;c<=m;++c)this.meshData.colors[l++]=h,this.meshData.colors[l++]=r,this.meshData.colors[l++]=a,this.meshData.colors[l++]=n;i.createMesh(this.meshData,this.mesh),this.meshRender.mesh=this.mesh},o.moveTo=function(t,s){this.topPos.set(t),this.bottomPos.set(s)},o.initMesh=function(){this.meshRender=this.node.getComponent(h),this.topPos=new r,this.bottomPos=new r,this.meshData={positions:[],uvs:[],indices:[],colors:[]},this.topVerts=[],this.bottomVerts=[];for(var t=this.color.r,s=this.color.g,o=this.color.b,e=this.color.a,a=0,n=0;n<=this.level;++n)this.topVerts.push(new r),this.meshData.uvs.push(n/this.level,0),this.bottomVerts.push(new r),this.meshData.uvs.push(n/this.level,1),this.meshData.positions.push(0,0,0,0,0,0),this.meshData.colors[a++]=t,this.meshData.colors[a++]=s,this.meshData.colors[a++]=o,this.meshData.colors[a++]=e,this.meshData.colors[a++]=t,this.meshData.colors[a++]=s,this.meshData.colors[a++]=o,this.meshData.colors[a++]=e;for(var l=0;l<this.level;++l)a=2*l,this.meshData.indices.push(a,a+1,a+2,a+2,a+1,a+3);this.mesh=i.createMesh(this.meshData),this.meshRender.mesh=this.mesh},o.updateMesh=function(t){this.topVerts[0].set(this.topPos),this.bottomVerts[0].set(this.bottomPos);for(var s=0==this.soft?.2:1/this.soft,o=1;o<=this.level;++o){var e=this.topVerts[o],h=this.topVerts[o-1];e.x+=(h.x-e.x)*s,e.y+=(h.y-e.y)*s,e.z+=(h.z-e.z)*s,e=this.bottomVerts[o],h=this.bottomVerts[o-1],e.x+=(h.x-e.x)*s,e.y+=(h.y-e.y)*s,e.z+=(h.z-e.z)*s}for(var r=0,a=0;a<=this.level;++a)this.meshData.positions[r++]=this.topVerts[a].x,this.meshData.positions[r++]=this.topVerts[a].y,this.meshData.positions[r++]=this.topVerts[a].z,this.meshData.positions[r++]=this.bottomVerts[a].x,this.meshData.positions[r++]=this.bottomVerts[a].y,this.meshData.positions[r++]=this.bottomVerts[a].z;i.createMesh(this.meshData,this.mesh),this.meshRender.mesh=this.mesh},o.checkPlayFinish=function(){var t=this.topVerts[0],s=this.topVerts[this.topVerts.length-1],o=1e-4;return!(Math.abs(t.x-s.x)>o)&&(!(Math.abs(t.y-s.y)>o)&&!(Math.abs(t.z-s.z)>o))},s}(p)).prototype,"color",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new e}}),P=a(y.prototype,"level",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),V=a(y.prototype,"soft",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),b=y))||b));s._RF.pop()}}}));

System.register("chunks:///_virtual/RoleAnimFrameEvent.ts",["cc","./_rollupPluginModLoBabelHelpers.js"],(function(t){"use strict";var e,n,i,r,o,a;return{setters:[function(t){e=t.cclegacy,n=t._decorator,i=t.Component},function(t){r=t.inheritsLoose,o=t.defineProperty,a=t.assertThisInitialized}],execute:function(){var l;e._RF.push({},"eaa6dYmkUhPS7m824si2ffY","RoleAnimFrameEvent",void 0);var s=n.ccclass;n.property,t("RoleAnimFrameEvent",s("RoleAnimFrameEvent")(l=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return e=t.call.apply(t,[this].concat(i))||this,o(a(e),"role",null),e}r(e,t);var n=e.prototype;return n.setRole=function(t){this.role=t},n.atkStart=function(){this.role.animAtkStart()},n.atkEnd=function(){this.role.animAtkEnd()},n.playAudio=function(t){this.role.isPlayer&&this.role.animPlayAudio(t)},n.playEffect=function(t){this.role.animPlayEffect(t)},n.shake=function(){this.role.isPlayer&&this.role.animShake()},e}(i))||l);e._RF.pop()}}}));

System.register("chunks:///_virtual/AtkBox.ts",["cc","./_rollupPluginModLoBabelHelpers.js","./GameConfig.ts","./GameEventType.ts","./EventManager.ts","./GlobalEnum.ts"],(function(i){"use strict";var t,s,h,a,e,o,n,r,c;return{setters:[function(i){t=i.cclegacy,s=i.Intersection2D,h=i.v2,a=i.Rect},function(i){e=i.defineProperty},function(i){o=i.default},function(i){n=i.EventType},function(i){r=i.default},function(i){c=i.GlobalEnum}],execute:function(){t._RF.push({},"f982ai2vD9KdIA6GvD/PEKc","AtkBox",void 0);var x=1.5707963265;i("default",function(){function i(){e(this,"atkRole",void 0),e(this,"radian",void 0),e(this,"sin",void 0),e(this,"cos",void 0),e(this,"tan",void 0),e(this,"position",void 0),e(this,"x",void 0),e(this,"y",void 0),e(this,"type",void 0),e(this,"_aabb",void 0),e(this,"radius",void 0),e(this,"radiusSqr",void 0),e(this,"halfRadianScope",void 0),e(this,"halfSin",void 0),e(this,"halfCos",void 0),e(this,"halfTan",void 0),e(this,"arc",void 0),e(this,"bordLeftV",void 0),e(this,"bordRightV",void 0),e(this,"halfWidth",void 0),e(this,"length",void 0),e(this,"rect",void 0),e(this,"scopePolygon",void 0),e(this,"cachePos",void 0),e(this,"barrierRect",void 0),e(this,"visible",!1),e(this,"audioClip",null),this.position=h(),this._aabb={xMin:0,xMax:0,xScope:0,xCenter:0,yMin:0,yMax:1e4,yScope:1e4,yCenter:5e3,zMin:0,zMax:0,zScope:0,zCenter:0},this.arc={pointLeft:h(),pointRight:h()},this.bordLeftV=h(),this.bordRightV=h(),this.rect=new a,this.scopePolygon=[h(),h(),h(),h()],this.cachePos=h(),this.barrierRect=new a,this.visible=!1}var t=i.prototype;return t.init=function(){this.visible=!1},t.reset=function(){this.visible=!1},t.setScope=function(i){switch(this.atkRole=i.atkRole,this.radian=i.radian,this.radian<0&&(this.radian+=6.283185306),this.sin=Math.sin(this.radian),this.cos=Math.cos(this.radian),this.tan=Math.tan(this.radian),this.x=this.atkRole.node.position.x,this.y=-this.atkRole.node.position.z,this.position.x=this.x,this.position.y=this.y,this.type=i.type,this.type){case c.AtkScopeType.fan:this.radius=i.radius,this.radiusSqr=this.radius*this.radius,this.halfRadianScope=i.halfRadianScope,this.halfSin=Math.sin(this.halfRadianScope),this.halfCos=Math.cos(this.halfRadianScope),this.halfTan=Math.tan(this.halfRadianScope);var t=this.radian-this.halfRadianScope+x;this.bordRightV.x=Math.cos(t),this.bordRightV.y=Math.sin(t);var s=this.radian+this.halfRadianScope-x;this.bordLeftV.x=Math.cos(s),this.bordLeftV.y=Math.sin(s);var h=this.radian+this.halfRadianScope;this.arc.pointLeft.x=this.radius*Math.cos(h)+this.x,this.arc.pointLeft.y=this.radius*Math.sin(h)+this.y;var a=this.radian-this.halfRadianScope;this.arc.pointRight.x=this.radius*Math.cos(a)+this.x,this.arc.pointRight.y=this.radius*Math.sin(a)+this.y;var e=this.x,o=this.x;this.checkPointInFan(this.x-this.radius,this.y,this.x,this.y)?e=this.x-this.radius:(e>this.arc.pointLeft.x&&(e=this.arc.pointLeft.x),e>this.arc.pointRight.x&&(e=this.arc.pointRight.x)),this.checkPointInFan(this.x+this.radius,this.y,this.x,this.y)?o=this.x+this.radius:(o<this.arc.pointLeft.x&&(o=this.arc.pointLeft.x),o<this.arc.pointRight.x&&(o=this.arc.pointRight.x));var n=-this.y,r=-this.y;this.checkPointInFan(this.x,this.y+this.radius,this.x,this.y)?n=-this.y-this.radius:(n>-this.arc.pointLeft.y&&(n=-this.arc.pointLeft.y),n>-this.arc.pointRight.y&&(n=-this.arc.pointRight.y)),this.checkPointInFan(this.x,this.y-this.radius,this.x,this.y)?r=-this.y+this.radius:(r<-this.arc.pointLeft.y&&(r=-this.arc.pointLeft.y),r<-this.arc.pointRight.y&&(r=-this.arc.pointRight.y)),this._aabb.xMin=e,this._aabb.xMax=o,this._aabb.xScope=.5*(this._aabb.xMax-this._aabb.xMin),this._aabb.xCenter=this._aabb.xMin+this._aabb.xScope,this._aabb.zMin=n,this._aabb.zMax=r,this._aabb.zScope=.5*(this._aabb.zMax-this._aabb.zMin),this._aabb.zCenter=this._aabb.zMin+this._aabb.zScope;break;case c.AtkScopeType.rect:this.halfWidth=i.halfWidth,this.length=i.length,this.rect.set(0,-this.halfWidth,this.length,2*this.halfWidth);var b=this.halfWidth*this.sin,l=this.halfWidth*this.cos,y=this.length*this.cos,d=this.length*this.sin;this.scopePolygon[0].x=this.x-b,this.scopePolygon[0].y=this.y+l,this.scopePolygon[1].x=this.x+y-b,this.scopePolygon[1].y=this.y+d+l,this.scopePolygon[2].x=this.x+y+b,this.scopePolygon[2].y=this.y+d-l,this.scopePolygon[3].x=this.x+b,this.scopePolygon[3].y=this.y-l,this._aabb.xMin=this.scopePolygon[1].x,this._aabb.xMax=this.scopePolygon[1].x,this._aabb.zMin=-this.scopePolygon[1].y,this._aabb.zMax=-this.scopePolygon[1].y;for(var p=1;p<4;++p)this._aabb.xMin>this.scopePolygon[p].x&&(this._aabb.xMin=this.scopePolygon[p].x),this._aabb.xMax<this.scopePolygon[p].x&&(this._aabb.xMax=this.scopePolygon[p].x),this._aabb.zMin>-this.scopePolygon[p].y&&(this._aabb.zMin=-this.scopePolygon[p].y),this._aabb.zMax<-this.scopePolygon[p].y&&(this._aabb.zMax=-this.scopePolygon[p].y);this._aabb.xScope=.5*(this._aabb.xMax-this._aabb.xMin),this._aabb.xCenter=this._aabb.xMin+this._aabb.xScope,this._aabb.zScope=.5*(this._aabb.zMax-this._aabb.zMin),this._aabb.zCenter=this._aabb.zMin+this._aabb.zScope}},t.getAABB=function(){return this._aabb},t.checkAABB=function(i){if(this.atkRole.Id==i.Id)return!1;var t=this._aabb,s=i.getAABB();return t.xMax>=s.xMin&&t.xMin<=s.xMax&&t.yMax>=s.yMin&&t.yMin<=s.yMax&&t.zMax>=s.zMin&&t.zMin<=s.zMax},t.onColled=function(i){switch(i.collerType){case c.CollerType.role:this.colledRole(i);break;case c.CollerType.barrier:this.colledBarrier(i)}},t.processHitAudio=function(){this.audioClip&&this.atkRole.disToPlayerSqr<o.GameRule.enemyAudioScopeSqr&&this.playAudio(this.audioClip),this.audioClip=null},t.hitSuccess=function(i){if(this.atkRole.hitSuccess(i),i.beHit(this.atkRole),this.atkRole.isPlayer&&i.collerType==c.CollerType.barrier)switch(i.breakAudioType){case 0:this.audioClip=c.AudioClip.breakWood;break;case 1:this.audioClip=c.AudioClip.breakStones;break;case 2:this.audioClip=c.AudioClip.breakMetal}},t.playAudio=function(i){r.emit(n.Common.AudioEvent.playEffect,i)},t.colledRole=function(i){if(!i.invicible&&i.isAlive)switch(this.type){case c.AtkScopeType.rect:this.checkRoleRect(i);break;case c.AtkScopeType.fan:this.checkRoleFan(i)}},t.checkRoleRect=function(i){var t=i.getAABB(),h=t.xScope,a=t.xCenter-this.x,e=-t.zCenter-this.y;this.cachePos.x=a*this.cos+e*this.sin,this.cachePos.y=e*this.cos-a*this.sin,s.rectCircle(this.rect,this.cachePos,h)&&this.hitSuccess(i)},t.checkRoleFan=function(i){var t=i.getAABB();if(this.checkPointInFan(t.xCenter,-t.zCenter,this.x,this.y,this.radiusSqr))this.hitSuccess(i);else{var s=t.xScope,h=s/this.halfSin,a=this.x-h*this.cos,e=this.y-h*this.sin,o=this.radius+s+h;if(o*=o,this.checkPointInFan(t.xCenter,-t.zCenter,a,e,o)){var n;n=s*s;var r=t.xCenter-a,c=-t.zCenter-e;if(r*r+c*c<n)return;this.hitSuccess(i)}else;}},t.colledBarrier=function(i){switch(this.type){case c.AtkScopeType.rect:this.checkBarrierRect(i);break;case c.AtkScopeType.fan:this.checkBarrierFan(i)}},t.checkBarrierRect=function(i){var t=i.getAABB();this.barrierRect.set(t.xMin,-t.zMax,t.xMax-t.xMin,t.zMax-t.zMin),s.rectPolygon(this.barrierRect,this.scopePolygon)&&this.hitSuccess(i)},t.checkBarrierFan=function(i){var t=i.getAABB();this.barrierRect.set(t.xMin,-t.zMax,t.xMax-t.xMin,t.zMax-t.zMin),(s.lineRect(this.position,this.arc.pointLeft,this.barrierRect)||s.lineRect(this.position,this.arc.pointRight,this.barrierRect)||this.checkPointInFan(this.barrierRect.x,this.barrierRect.y,this.x,this.y,this.radiusSqr)||this.checkPointInFan(this.barrierRect.x,this.barrierRect.yMax,this.x,this.y,this.radiusSqr)||this.checkPointInFan(this.barrierRect.xMax,this.barrierRect.y,this.x,this.y,this.radiusSqr)||this.checkPointInFan(this.barrierRect.xMax,this.barrierRect.yMax,this.x,this.y,this.radiusSqr)||this.checkLineHCrossFan(this.barrierRect.x,this.barrierRect.xMax,this.barrierRect.y)||this.checkLineHCrossFan(this.barrierRect.x,this.barrierRect.xMax,this.barrierRect.yMax)||this.checkLineVCrossFan(this.barrierRect.x,this.barrierRect.y,this.barrierRect.yMax)||this.checkLineVCrossFan(this.barrierRect.xMax,this.barrierRect.y,this.barrierRect.yMax))&&this.hitSuccess(i)},t.checkPointInFan=function(i,t,s,h,a){return i-=s,t-=h,!(a&&i*i+t*t>a)&&(i*this.bordLeftV.x+t*this.bordLeftV.y>0&&i*this.bordRightV.x+t*this.bordRightV.y>0)},t.checkLineVCrossFan=function(i,t,s){var h=i-this.x;if(h*=h,this.radiusSqr<h)return!1;h=Math.sqrt(this.radiusSqr-h);var a=this.y-h;if(a>s)return!1;var e=this.y+h;return!(e<t)&&(!(a<t&&e>s)&&(this.checkPointInFan(i,this.y+h,this.x,this.y)||this.checkPointInFan(i,this.y-h,this.x,this.y)))},t.checkLineHCrossFan=function(i,t,s){var h=s-this.y;if(h*=h,this.radiusSqr<h)return!1;h=Math.sqrt(this.radiusSqr-h);var a=this.x-h;if(a>t)return!1;var e=this.x+h;return!(e<i)&&(!(a<i&&e>t)&&(this.checkPointInFan(this.x+h,s,this.x,this.y)||this.checkPointInFan(this.x-h,s,this.x,this.y)))},i}());t._RF.pop()}}}));

System.register("chunks:///_virtual/Role",["./AtkBox.ts","./RoleAnimFrameEvent.ts","./Role.ts","./ScanBox.ts","./Enemy.ts","./Weapon.ts","./AtkScopeFan.ts","./AtkScopeRect.ts","./ShopRole.ts","./Player.ts","./RoleDeadAnim.ts","./WeaponStreak.ts"],(function(){"use strict";return{setters:[null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){}}}));

(function(r) {
  r('virtual:///prerequisite-imports/Role', 'chunks:///_virtual/Role'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});