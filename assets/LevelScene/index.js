System.register("chunks:///_virtual/LevelManager.ts",["cc","./_rollupPluginModLoBabelHelpers.js","./GameEventType.ts","./GlobalEnum.ts","./Action3dManager.ts","./yyComponent.ts"],(function(t){"use strict";var e,i,n,s,o,a,l,u,r,h,v,c,m,p,d;return{setters:[function(t){e=t.cclegacy,i=t.Node,n=t._decorator,s=t.warn},function(t){o=t.applyDecoratedDescriptor,a=t.inheritsLoose,l=t.defineProperty,u=t.assertThisInitialized,r=t.initializerDefineProperty,h=t.createClass},function(t){v=t.EventType},function(t){c=t.GlobalEnum},function(t){m=t.default,p=t.ActionMngType},function(t){d=t.default}],execute:function(){var L,f,C,y;e._RF.push({},"8a3a1r8py9NEZq3f4jOfVcp","LevelManager",void 0);var b=n,S=b.ccclass,g=b.property;t("default",(L=g(i),S((y=o((C=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];return e=t.call.apply(t,[this].concat(n))||this,l(u(e),"isPaused",void 0),l(u(e),"pauseCount",0),l(u(e),"elapseTimer",void 0),l(u(e),"lastFrameTime",void 0),l(u(e),"levelData",void 0),r(u(e),"levelLayer",y,u(e)),l(u(e),"actMng",null),l(u(e),"nextState",null),l(u(e),"needLoadCount",0),e}a(e,t);var i=e.prototype;return i.init=function(){this.initCustomUpdateState(),this.initLevelTimer(),this.initActMng(),this.initEnterLobbyState(),this.loadLobbyItems(),this.registAllCustomUpdate(),this.onEvents(),s("关卡管理器的init需由子类实现")},i.registAllCustomUpdate=function(){s("关卡管理器的registAllCustomUpdate需由子类实现"),this.registCustomUpdate(c.LevelState.lobby,this.stepLobby),this.registCustomUpdate(c.LevelState.win,this.stepLevelWin),this.registCustomUpdate(c.LevelState.lose,this.stepLevelLose),this.registCustomUpdate(c.LevelState.playing,this.stepLevelPlaying)},i.onEvents=function(){s("关卡管理器的onEvents需由子类实现"),this.on(v.Common.DirectorEvent.pauseLevel,this.pause,this),this.on(v.Common.DirectorEvent.resumeLevel,this.resume,this)},i.loadLobbyItems=function(){},i.reset=function(){this.resetCustomUpdateState(),this.resetLevelTimer()},i.pause=function(t){void 0===t&&(t=1),this.pauseCount+=t,this.isPaused=!0},i.resume=function(t){void 0===t&&(t=1),-1===t?(this.pauseCount=0,this.isPaused=!1):(this.pauseCount-=t,this.pauseCount<=0&&(this.pauseCount=0,this.isPaused=!1))},i.initLevelTimer=function(){this.elapseTimer=0,this.isPaused=!1,this.pauseCount=0},i.resetLevelTimer=function(){this.elapseTimer=0,this.isPaused=!1,this.pauseCount=0},i.customUpdate=function(){if(!this.isPaused){var t=Date.now(),e=t-this.lastFrameTime;this.lastFrameTime=t,e>34&&(e=34),e*=.001,this.elapseTimer+=e,this.customStep&&this.customStep(e)}},i.running=function(t){this.isPaused||(this.updateAction(t),this.customStep&&this.customStep(t))},i.getLevelData=function(){return this.levelData},i.initActMng=function(){this.actMng=m.getMng(p.Level)},i.updateAction=function(t){this.actMng.update(t)},i.enterLevel=function(t){this.node.active=!0,this.needLoadCount<=0?(this.reset(),this.levelData=t,this._enterLevel()):(this.levelData=t,this.nextState=c.LevelState.playing)},i._enterLevel=function(){this.setData(),this.startLevel()},i.startLevel=function(){this.enterCustomUpdateState(c.LevelState.playing),this.lastFrameTime=Date.now(),this.emit(v.Common.CtrlEvent.ctrlStart),Math.random()>.5?this.emit(v.Common.AudioEvent.playBGM,c.AudioClip.BGM,!0):this.emit(v.Common.AudioEvent.playBGM,c.AudioClip.BGM2,!0);var t=this.levelData.lv;void 0===t&&(t=this.levelData.id),this.emit(v.Common.ALDEvent.levelStart,t)},i.setTeachCmp=function(t){},i.exit=function(){this.reset()},i.initEnterLobbyState=function(){this.nextState=null,this.needLoadCount=0,console.warn("进入首页必须加载的预制件数量为：",this.needLoadCount)},i.enterLobby=function(){this.needLoadCount<=0?(this.reset(),this.setEnterLobbyData(),this.enterCustomUpdateState(c.LevelState.lobby)):this.nextState=c.LevelState.lobby},i.setEnterLobbyData=function(){console.log("设置关卡场景作为首页背景时的数据，由子类实现")},i.loadLobbyItemFinish=function(){if(this.needLoadCount--,this.needLoadCount<=0){switch(this.nextState){case c.LevelState.lobby:this.setEnterLobbyData(),this.enterCustomUpdateState(c.LevelState.lobby);break;case c.LevelState.playing:this._enterLevel()}this.emit(v.LevelEvent.levelSceneLoadFinish)}},i.stepLevelPlaying=function(t){},i.stepLevelWin=function(t){},i.stepLevelLose=function(t){},i.stepLobby=function(t){},i.win=function(t){this.enterCustomUpdateState(c.LevelState.win),this.emit(v.Common.CtrlEvent.ctrlEnd),this.emit(v.Common.DirectorEvent.playerWin,t),this.emit(v.Common.SDKEvent.stopRecord);var e=this.levelData.lv;void 0===e&&(e=this.levelData.id),this.emit(v.Common.ALDEvent.levelWin,e)},i.lose=function(t){this.enterCustomUpdateState(c.LevelState.lose),this.emit(v.Common.CtrlEvent.ctrlEnd),this.emit(v.Common.DirectorEvent.playerLose,t),this.emit(v.Common.SDKEvent.stopRecord);var e=this.levelData.lv;void 0===e&&(e=this.levelData.id),this.emit(v.Common.ALDEvent.levelLose,e)},h(e,[{key:"paused",get:function(){return this.isPaused}}]),e}(d)).prototype,"levelLayer",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),f=C))||f));e._RF.pop()}}}));

System.register("chunks:///_virtual/MyLevelManager.ts",["cc","./_rollupPluginModLoBabelHelpers.js","./GameEventType.ts","./GlobalEnum.ts","./GlobalData2.ts","./PlayerData.ts","./GlobalPool.ts","./GameData.ts","./GoldItem.ts","./LevelManager.ts","./LevelCamera.ts","./AIManager.ts","./CollerManager.ts"],(function(e){"use strict";var t,i,a,n,r,o,s,l,h,d,p,u,c,m,y,v,f,B,g,L,A,C;return{setters:[function(e){t=e.cclegacy,i=e.Node,a=e._decorator,n=e.v3},function(e){r=e.applyDecoratedDescriptor,o=e.inheritsLoose,s=e.defineProperty,l=e.assertThisInitialized,h=e.initializerDefineProperty,d=e.createClass},function(e){p=e.EventType},function(e){u=e.GlobalEnum},function(e){c=e.default},function(e){m=e.default},function(e){y=e.default,v=e.customPoolScript},function(e){f=e.default},function(e){B=e.GoldItem},function(e){g=e.default},function(e){L=e.default},function(e){A=e.default},function(e){C=e.default}],execute:function(){var k,P,E,b,D,S,x,T,G,M,z,R,w,U,I,W,F,N,O,j,_,H,K,Q,Y,J,q,V,X,Z,$,ee,te,ie;t._RF.push({},"96965tMQ3pGBpQf/2vNsU/8","MyLevelManager",void 0);var ae=a,ne=ae.ccclass,re=ae.property;e("default",(k=re(i),P=re(L),E=re(i),b=re(i),D=re(i),S=re(i),x=re(i),T=re(i),G=re(i),M=re(i),z=re(i),R=re(i),w=re(i),U=re(i),I=re(i),W=re(i),ne((O=r((N=function(e){function t(){for(var t,i=arguments.length,a=new Array(i),n=0;n<i;n++)a[n]=arguments[n];return t=e.call.apply(e,[this].concat(a))||this,s(l(t),"isPaused",void 0),s(l(t),"pauseCount",0),s(l(t),"enemyEnterPos",[]),s(l(t),"grade",null),h(l(t),"playerLayer",O,l(t)),s(l(t),"player",null),s(l(t),"playerDeadBody",null),h(l(t),"camera",j,l(t)),h(l(t),"mapLayer",_,l(t)),s(l(t),"mapScope",void 0),h(l(t),"portalLayer",H,l(t)),s(l(t),"allPortals",[]),s(l(t),"portalPairId",0),s(l(t),"portalPairs",{}),h(l(t),"staticBarrierLayer",K,l(t)),h(l(t),"dynamicBarrierLayer",Q,l(t)),s(l(t),"dynamicBarriers",[]),h(l(t),"breakBarrierLayer",Y,l(t)),h(l(t),"breakAnimLayer",J,l(t)),s(l(t),"breakAnims",[]),h(l(t),"goldLayer",q,l(t)),s(l(t),"allGolds",[]),h(l(t),"bodyLayer",V,l(t)),s(l(t),"allDeadBodies",[]),h(l(t),"roleLayer",X,l(t)),s(l(t),"allEnemies",[]),h(l(t),"weaponStreakLayer",Z,l(t)),h(l(t),"scanBoxLayer",$,l(t)),h(l(t),"boomLayer",ee,l(t)),h(l(t),"particleLayer",te,l(t)),s(l(t),"colliderLayer",null),s(l(t),"allAtkBox",[]),h(l(t),"trapperLayer",ie,l(t)),s(l(t),"allTrappers",[]),s(l(t),"playerScale",1),s(l(t),"playerDeadPosition",void 0),s(l(t),"canResurgence",!0),t}o(t,e);var i=t.prototype;return i.init=function(){this.initActMng(),this.initAtkBox(),this.initBodyLayer(),this.initBoom(),this.initBreakAnims(),this.initBreakBarrier(),this.initCamera(),this.initCollMng(),this.initColliderLayer(),this.initCustomUpdateState(),this.initDynamicBarrier(),this.initEnemies(),this.initEnterLobbyState(),this.initGold(),this.initGrade(),this.initLevelTimer(),this.initMap(),this.initParticle(),this.initPlayer(),this.initScanBox(),this.initStaticBarrier(),this.initTrappers(),this.initWeaponStreak(),this.loadLobbyItems(),this.registAllCustomUpdate(),this.onEvents()},i.registAllCustomUpdate=function(){this.registCustomUpdate(u.LevelState.waitTrySkin,this.stepWaitTrySkin),this.registCustomUpdate(u.LevelState.playing,this.stepLevelPlaying),this.registCustomUpdate(u.LevelState.win,this.stepLevelWin),this.registCustomUpdate(u.LevelState.lose,this.stepLevelLose),this.registCustomUpdate(u.LevelState.lobby,this.stepLobby),this.registCustomUpdate(u.LevelState.fighting,this.stepPlayerFighting)},i.onEvents=function(){this.on(p.Common.DirectorEvent.pauseLevel,this.pause,this),this.on(p.Common.DirectorEvent.resumeLevel,this.resume,this),this.on(p.LevelEvent.testLose,this.onTestLose,this),this.on(p.LevelEvent.testWin,this.onTestWin,this),this.on(p.LevelEvent.resurgence,this.onResurgence,this),this.on(p.LevelEvent.killPlayer,this.onPlayerDead,this),this.on(p.LevelEvent.playerDeadAnimFinished,this.onPlayerDeadAnimFinished,this),this.on(p.LevelEvent.addRigidNode,this.onAddRigidNode,this),this.on(p.LevelEvent.removeBreakBarrier,this.onRemoveBreakBarrier,this),this.on(p.LevelEvent.removeDynamicBarrier,this.onRemoveDynamicBarrier,this),this.on(p.LevelEvent.addBreakAnim,this.onAddBreakAnim,this),this.on(p.LevelEvent.removeBreakAnim,this.onRemoveBreakAnim,this),this.on(p.LevelEvent.dropGold,this.onDropGold,this),this.on(p.LevelEvent.addGoldColler,this.onAddGoldColler,this),this.on(p.LevelEvent.getGold,this.onGetGold,this),this.on(p.LevelEvent.removeGold,this.onRemoveGold,this),this.on(p.LevelEvent.addAtkBox,this.onAddAtkBox,this),this.on(p.LevelEvent.removeAtkBox,this.onRemoveAtkBox,this),this.on(p.LevelEvent.playerKillEnemy,this.onPlayerKillEnemy,this),this.on(p.LevelEvent.enemyDead,this.onEnemyDead,this),this.on(p.LevelEvent.addDeadBody,this.onAddDeadBody,this),this.on(p.LevelEvent.deadAnimFinish,this.onDeadAnimFinish,this),this.on(p.LevelEvent.addWeaponStreak,this.addWeaponStreak,this),this.on(p.LevelEvent.removeWeaponStreak,this.removeWeaponStreak,this),this.on(p.LevelEvent.addScanBox,this.onAddScanBox,this),this.on(p.LevelEvent.addParticle,this.onAddParticle,this),this.on(p.LevelEvent.decideWeaponSkin,this.onDecideSkin,this),this.on(p.LevelEvent.addTrapper,this.addTrapper,this),this.on(p.LevelEvent.removeTrapper,this.removeTrapper,this),this.on(p.LevelEvent.addBoomEffect,this.addBoom,this)},i.loadLobbyItems=function(){},i.reset=function(){this.resetAtkBox(),this.resetBodyLayer(),this.resetBoom(),this.resetBreakAnims(),this.resetBreakBarrier(),this.resetCamera(),this.resetCollMng(),this.resetColliderLayer(),this.resetCustomUpdateState(),this.resetDynamicBarrier(),this.resetEnemies(),this.resetGold(),this.resetGrade(),this.resetLevelTimer(),this.resetMap(),this.resetParticle(),this.resetPlayer(),this.resetScanBox(),this.resetSimpleComps(),this.resetStaticBarrier(),this.resetTrappers(),this.resetWeaponStreak()},i.pause=function(e){void 0===e&&(e=1),this.paused,this.pauseCount+=e,this.isPaused=!0},i.resume=function(e){void 0===e&&(e=1),-1===e?(this.pauseCount=0,this.isPaused=!1):(this.pauseCount-=e,this.pauseCount<=0&&(this.pauseCount=0,this.isPaused=!1)),this.paused},i.enterLevel=function(e){this.node.active=!0,this.needLoadCount<=0?(this.reset(),this.levelData=e,this._enterLevel()):(this.levelData=e,this.nextState=u.LevelState.playing)},i._enterLevel=function(){this.setData(),this.camera.moveTo(0,n(0,0,0)),this.playCameraEnterLevel()},i.setData=function(){for(var e=[],t=this.levelData.data.maps,i=0;i<t.length;++i)this.setMap(t[i]);this.setCollMngScope();for(var a=0;a<t.length;++a){var n=t[a].p,r=f.getData(u.GameDataType.MapData,t[a].n);this.setBreakBarrier(n,r.breakBarriers),this.setDynamicBarrier(n,r.dynamicBarriers),this.setStaticBarrier(n,r.staticBarriers);for(var o=r.enemyPos,s=0,l=o.length;s<l;++s)e.push({x:n.x+o[s].x,y:n.y+o[s].y,z:n.z+o[s].z})}this.enemyEnterPos=e;var h=c.get(u.myGlobalDataType.matchEnemies);this.setEnemies(h);var d=m.getData("gameData.WeaponSkin"),p=d.cur;d.try.type!==u.WeaponType.none&&0!==d.try.id&&(p=d.try),this.setPlayer({p:this.getRandomEnemyPos(),skin:m.getCurSkinId(u.GameDataType.playerSkin),weaponType:p.type,weaponId:p.id,hat:m.getCurSkinId("HatSkin")}),this.camera.setTarget(this.player.node),this.camera.enterLevel(),this.canResurgence=!0},i.setTeachCmp=function(e){},i.setEnterLobbyData=function(){},i.initGrade=function(){this.grade={gold:0,killed:0}},i.resetGrade=function(){this.grade.gold=0,this.grade.killed=0},i.addGradeGold=function(){this.grade.gold+=1,this.emit(p.LevelEvent.updateGold,this.grade.gold)},i.addGradeKilled=function(){this.grade.killed+=1,this.emit(p.Common.AudioEvent.playEffect,u.AudioClip.killed)},i.getResultData=function(){return{lv:this.levelData.lv,gold:this.grade.gold+100}},i.initPlayer=function(){},i.resetPlayer=function(){this.player&&(y.put(this.player.node),this.player=null,c.set(u.myGlobalDataType.player,null)),this.playerDeadBody&&(y.put(this.playerDeadBody),this.playerDeadBody=null)},i.setPlayer=function(e){this.resetPlayer();var t=y.get("Player",e);this.player=t[v],this.playerLayer.addChild(t),this.player.setEulerAngles(-90),this.player.enableRigidNode(),this.player.enterLevel(),c.set(u.myGlobalDataType.player,this.player)},i.updatePlayer=function(e){this.player.customUpdate(e)},i.initCamera=function(){this.camera.init(),c.set(u.Common.GlobalDataType.levelCamera,this.camera)},i.resetCamera=function(){this.camera.reset()},i.updateCamera=function(e){this.camera.customUpdate(e)},i.playCameraEnterLevel=function(){var e=this;this.camera.changeCamera({duration:0,pos:n(0,70,15),angle:n(-80,0,0)}),this.camera.moveTo(.5,this.player.node.position),this.camera.resumeOriginalTransform(1,(function(){e.startLevel(),e.emit(p.LevelEvent.showHandAnim),setTimeout((function(){e.showUI(u.UI.trySkin),e.enterCustomUpdateState(u.LevelState.waitTrySkin)}),1e3)}))},i.initMap=function(){},i.resetMap=function(){this.mapScope=null,this.removeMap()},i.removeMap=function(){y.putAllChildren(this.mapLayer)},i.setMap=function(e){var t=y.get(e.n);this.mapLayer.addChild(t),t.setPosition(e.p),t[v].enableRigidNode();var i=f.getData(u.GameDataType.MapData,e.n).scope,a=i.xMin+e.p.x,n=i.xMax+e.p.x,r=i.zMin+e.p.z,o=i.zMax+e.p.z;this.mapScope?(this.mapScope.xMin>a&&(this.mapScope.xMin=a),this.mapScope.xMax<n&&(this.mapScope.xMax=n),this.mapScope.zMin>r&&(this.mapScope.zMin=r),this.mapScope.zMax<o&&(this.mapScope.zMax=o)):this.mapScope={xMin:a,xMax:n,zMin:r,zMax:o}},i.getRandomEnemyPos=function(){var e=Math.round(Math.random()*(this.enemyEnterPos.length-1)),t=this.enemyEnterPos[e];return this.enemyEnterPos.length>1&&this.enemyEnterPos.splice(e,1),t},i.initPortal=function(){this.allPortals=[],this.portalPairs={}},i.resetPortal=function(){y.putAllChildren(this.portalLayer,!0),this.allPortals=[],this.portalPairs={}},i.setPortals=function(){for(var e=this.levelData.data.maps,t=e.length-1;t>=0;--t)for(var i=f.getData(u.GameDataType.MapData,e[t].n),a=e[t].p,n=i.portalPos.length-1;n>=0;--n)this.addPortal(a,i.portalPos[n]);var r=e.length-1;if(r>=1){for(var o=0;o<r;++o)this.allPortals[2*o].nextDoor=this.allPortals[2*o+3],this.allPortals[2*o+3].nextDoor=this.allPortals[2*o];this.allPortals[2*r].nextDoor=this.allPortals[1],this.allPortals[1].nextDoor=this.allPortals[2*r]}},i.addPortal=function(e,t){var i=y.get("Portal");this.portalLayer.addChild(i),this.allPortals.push(i[v]),i[v].setPosition(n(e.x+t.x,0,e.z+t.z))},i.updatePortal=function(e){this.runCustomUpdate(this.allPortals,e)},i.processPortalPairs=function(){for(var e in this.portalPairs)this.portalPairs[e].role.isAlive?this.portalPairs[e].portal.visible&&delete this.portalPairs[e]:(this.portalPairs[e].portal.closeDoor(),delete this.portalPairs[e])},i.checkPortal=function(){for(var e=this.allPortals.length-1;e>=0;--e)if(this.allPortals[e].visible&&this.allPortals[e].nextDoor.visible){var t=this.allPortals[e];if(this.player.isAlive&&t.checkCollRole(this.player)){var i=this.portalPairId++;this.portalPairs[i]={role:this.player,portal:t},t.chuanSongRole(this.player,i)}else for(var a=this.allEnemies.length-1;a>=0;--a)if(this.allEnemies[a].isAlive&&t.checkCollRole(this.allEnemies[a])){var n=this.portalPairId++;this.portalPairs[n]={role:this.allEnemies[a],portal:t},t.chuanSongRole(this.allEnemies[a],n);break}}},i.initStaticBarrier=function(){},i.resetStaticBarrier=function(){y.putAllChildren(this.staticBarrierLayer)},i.setStaticBarrier=function(e,t){for(var i=0,a=t.length;i<a;++i)this.addStaticBarrier(e,t[i])},i.addStaticBarrier=function(e,t){var i=y.get(t.n,t);this.staticBarrierLayer.addChild(i);var a=i[v];a?(a.setPosition(n(t.p.x+e.x,t.p.y+e.y,t.p.z+e.z)),a.enableRigidNode()):i.setPosition(t.p.x+e.x,t.p.y+e.y,t.p.z+e.z)},i.initDynamicBarrier=function(){this.dynamicBarriers=[]},i.resetDynamicBarrier=function(){y.putAllChildren(this.dynamicBarrierLayer),this.dynamicBarriers=[]},i.setDynamicBarrier=function(e,t){for(var i=0,a=t.length;i<a;++i)this.addDynamicBarrier(e,t[i])},i.addDynamicBarrier=function(e,t){var i=y.get(t.n,t);this.dynamicBarrierLayer.addChild(i);var a=i[v];a?(this.dynamicBarriers.push(a),a.setPosition(n(t.p.x+e.x,t.p.y+e.y,t.p.z+e.z)),a.enableRigidNode()):i.setPosition(t.p.x+e.x,t.p.y+e.y,t.p.z+e.z)},i.removeDynamicBarrier=function(e){this.removeElementInArray(e,this.dynamicBarriers),y.put(e.node),C.removeObj(e,u.CollerType.barrier)},i.updateDynamicBarrier=function(e){this.runCustomUpdate(this.dynamicBarriers,e)},i.initBreakBarrier=function(){},i.resetBreakBarrier=function(){y.putAllChildren(this.breakBarrierLayer)},i.setBreakBarrier=function(e,t){for(var i=0,a=t.length;i<a;++i)this.addBreakBarrier(e,t[i])},i.addBreakBarrier=function(e,t){var i=y.get(t.n,t);this.breakBarrierLayer.addChild(i),i[v]?(i[v].setPosition(n(t.p.x+e.x,t.p.y+e.y,t.p.z+e.z)),i[v].enableRigidNode(),C.addObj(i[v],u.CollerType.barrier)):i.setPosition(t.p.x+e.x,t.p.y+e.y,t.p.z+e.z)},i.removeBreakBarrier=function(e){y.put(e.node),C.removeObj(e,u.CollerType.barrier)},i.initBreakAnims=function(){this.breakAnims=[]},i.resetBreakAnims=function(){y.putAllChildren(this.breakAnimLayer),this.breakAnims=[]},i.addBreakAnim=function(e){var t=y.get(e.breakEffectName);if(t){this.breakAnimLayer.addChild(t),this.breakAnims.push(t[v]);var i=360*Math.random();t.eulerAngles=n(0,i,0),t.setPosition(e.p),t[v].play()}},i.removeBreakAnim=function(e){y.put(e.node),this.removeElementInArray(e,this.breakAnims)},i.updateBreakAnims=function(e){this.runCustomUpdate(this.breakAnims,e)},i.initGold=function(){this.allGolds=[]},i.resetGold=function(){y.putAllChildren(this.goldLayer,!0),this.allGolds=[]},i.addGold=function(e){var t=y.get("GoldItem",e);this.goldLayer.addChild(t);var i=t[v];i.enterLevel(e.speed),this.allGolds.push(i)},i.removeGold=function(e){this.removeElementInArray(e,this.allGolds),y.put(e.node),C.removeObj(e,u.CollerType.props)},i.updateGold=function(e){B.radian+=e,B.sinY=Math.sin(B.radian),B.cosY=Math.cos(B.radian),this.runCustomUpdate(this.allGolds,e)},i.initBodyLayer=function(){this.allDeadBodies=[]},i.resetBodyLayer=function(){y.putAllChildren(this.bodyLayer,!0),this.allDeadBodies=[]},i.addDeadAnim=function(e){var t=e.anim?e.anim:"RoleDeadAnim",i=y.get(t);return this.bodyLayer.addChild(i),i[v]||console.log(i),i[v].play(e),this.allDeadBodies.push(i[v]),i},i.removeDeadAnim=function(e){this.removeElementInArray(e,this.allDeadBodies)},i.updateDeadAnim=function(e){this.runCustomUpdate(this.allDeadBodies,e)},i.initEnemies=function(){this.allEnemies=[],A.init()},i.resetEnemies=function(){A.reset(),y.putAllChildren(this.roleLayer,!0),this.allEnemies=[],c.set(u.myGlobalDataType.enemies,this.allEnemies)},i.setEnemies=function(e){var t=e.length;t>=this.enemyEnterPos.length&&(t=this.enemyEnterPos.length-1);for(var i=0;i<t;++i)this.addEnemy(e[i]);c.set(u.myGlobalDataType.enemies,this.allEnemies)},i.addEnemy=function(e){var t=y.get("Enemy",e);this.roleLayer.addChild(t);var i=t[v],a=360*Math.random();i.setEulerAngles(a);var n=this.getRandomEnemyPos();i.setPosition(n),i.enableRigidNode(),this.allEnemies.push(i),i.enterLevel(),A.addEnemy(i)},i.removeEnemy=function(e){A.removeEnemy(e),y.put(e.node),this.removeElementInArray(e,this.allEnemies)},i.updateEnemies=function(e){A.customUpdate(e),this.runCustomUpdate(this.allEnemies,e)},i.initWeaponStreak=function(){},i.resetWeaponStreak=function(){y.putAllChildren(this.weaponStreakLayer)},i.addWeaponStreak=function(e){this.weaponStreakLayer.addChild(e)},i.removeWeaponStreak=function(e){y.put(e)},i.updateWeaponStreak=function(e){},i.initScanBox=function(){},i.resetScanBox=function(){y.putAllChildren(this.scanBoxLayer,!0)},i.addScanBox=function(e){this.scanBoxLayer.addChild(e)},i.initBoom=function(){},i.resetBoom=function(){y.putAllChildren(this.boomLayer)},i.addBoom=function(e){var t=y.get("Boom");t.setPosition(e.p),this.boomLayer.addChild(t),t[v].play(e.s)},i.initParticle=function(){},i.resetParticle=function(){y.putAllChildren(this.particleLayer)},i.addParticle=function(e){var t=y.get(e.n);if(t){if(this.particleLayer.addChild(t),void 0!==e.s?t.setScale(e.s,e.s,e.s):t.setScale(1,1,1),void 0!==e.radian){var i=.5*e.radian;t.setRotation(0,Math.sin(i),0,Math.cos(i))}else t.setRotation(0,0,0,1);t[v].play(),t.setPosition(e.p)}},i.initColliderLayer=function(){this.colliderLayer=c.get(u.myGlobalDataType.colliderLayer)},i.resetColliderLayer=function(){},i.sync2to3=function(){this.runSyncFun("syncRigidToModel")},i.sync3to2=function(){this.runSyncFun("syncModelToRigid")},i.runSyncFun=function(e){this.player[e]();for(var t=this.allEnemies.length-1;t>=0;--t)this.allEnemies[t][e]();for(var i=this.dynamicBarriers.length-1;i>=0;--i)this.dynamicBarriers[i][e]();for(var a=this.allGolds.length-1;a>=0;--a)this.allGolds[a][e]()},i.initAtkBox=function(){this.allAtkBox=[]},i.resetAtkBox=function(){this.allAtkBox=[]},i.addAtkBox=function(e){this.allAtkBox.indexOf(e)<0&&this.allAtkBox.push(e)},i.removeAtkBox=function(e){var t=this.allAtkBox.indexOf(e);t>=0&&this.allAtkBox.splice(t,1)},i.checkAtkBox=function(){for(var e=this.allAtkBox.length-1;e>=0;--e)if(this.allAtkBox[e]&&this.allAtkBox[e].visible){var t=this.allAtkBox[e];C.checkColl(t,u.CollerType.barrier);for(var i=this.allEnemies,a=i.length-1;a>=0;--a)t.checkAABB(i[a])&&t.onColled(i[a]);for(var n=this.dynamicBarriers,r=n.length-1;r>=0;--r)t.checkAABB(n[r])&&t.onColled(n[r]);t.checkAABB(this.player)&&t.onColled(this.player),t.processHitAudio()}},i.initTrappers=function(){this.allTrappers=[]},i.resetTrappers=function(){y.putAllChildren(this.trapperLayer),this.allTrappers=[]},i.addTrapper=function(e){var t="trapper"+e.role.weaponId;t+=e.role.isPlayer?"player":"enemy";var i=y.get(t,e);this.trapperLayer.addChild(i),this.allTrappers.push(i[v])},i.removeTrapper=function(e){y.put(e.node),this.removeElementInArray(e,this.allTrappers)},i.updateTrapper=function(e){this.runCustomUpdate(this.allTrappers,e)},i.checkTrapperColl=function(){for(var e=this.allTrappers.length-1;e>=0;--e)if(this.allTrappers[e]&&this.allTrappers[e].visible){var t=this.allTrappers[e];C.checkColl(t,u.CollerType.barrier);for(var i=this.allEnemies,a=i.length-1;a>=0;--a)t.checkAABB(i[a].getAABB())&&t.onColled(i[a]);for(var n=this.dynamicBarriers,r=n.length-1;r>=0;--r)t.checkAABB(n[r].getAABB())&&t.onColled(n[r]);t.checkAABB(this.player.getAABB())&&t.onColled(this.player),t.processHitAudio(),t.visible||(y.put(t.node),this.allTrappers.splice(e,1))}},i.initCollMng=function(){C.init()},i.resetCollMng=function(){C.reset()},i.setCollMngScope=function(){C.setTreeScope(this.mapScope.xMin,this.mapScope.xMax,this.mapScope.zMin,this.mapScope.zMax)},i.updateCollMng=function(e){C.checkColl(this.player,u.CollerType.props);for(var t=this.allEnemies.length-1;t>=0;--t)C.checkColl(this.allEnemies[t],u.CollerType.props)},i.stepWaitTrySkin=function(e){},i.stepLevelPlaying=function(e){A.enterLevel(),this.enterCustomUpdateState(u.LevelState.fighting)},i.stepPlayerFighting=function(e){this.sync2to3(),this.updateBreakAnims(e),this.updateCollMng(e),this.updateDeadAnim(e),this.updateDynamicBarrier(e),this.updateEnemies(e),this.updateGold(e),this.updatePlayer(e),this.updateCamera(e),this.updateWeaponStreak(e),this.updateTrapper(e),this.updatePortal(e),this.checkPortal(),this.sync3to2(),this.checkAtkBox(),this.checkTrapperColl()},i.stepLevelWin=function(e){this.sync2to3(),this.updateBreakAnims(e),this.updateDeadAnim(e),this.updateDynamicBarrier(e),this.updateGold(e),this.updatePortal(e),this.updateTrapper(e),this.sync3to2()},i.stepLevelLose=function(e){this.sync2to3(),this.updateBreakAnims(e),this.updateDeadAnim(e),this.updateDynamicBarrier(e),this.updateEnemies(e),this.updateGold(e),this.updatePortal(e),this.updateTrapper(e),this.sync3to2(),this.checkAtkBox()},i.stepLobby=function(e){},i.onTestWin=function(){this.win()},i.onTestLose=function(){this.lose()},i.onPlayerDead=function(e){var t=this;this.playerScale=this.player.roleScale,this.playerDeadPosition=this.player.node.getPosition(),this.emit(p.Common.AudioEvent.stopBGM),this.emit(p.Common.AudioEvent.playEffect,u.AudioClip.lose),this.emit(p.Common.CtrlEvent.ctrlEnd),this.enterCustomUpdateState(u.LevelState.lose),this.playerDeadBody=this.addDeadAnim(e),setTimeout((function(){var e={canResurgence:t.canResurgence,lv:t.levelData.lv,gold:t.grade.gold};t.canResurgence=!1,t.lose(e)}),300)},i.onPlayerDeadAnimFinished=function(){},i.onResurgence=function(){Math.random()>.5?this.emit(p.Common.AudioEvent.playBGM,u.AudioClip.BGM,!0):this.emit(p.Common.AudioEvent.playBGM,u.AudioClip.BGM2,!0),y.put(this.playerDeadBody),this.playerDeadBody=null,this.player.setRoleScale(this.playerScale),this.player.resurgence(this.playerDeadPosition),this.emit(p.Common.CtrlEvent.ctrlStart),this.enterCustomUpdateState(u.LevelState.playing)},i.onWinAnimFinish=function(){this.win(this.getResultData())},i.onLoseAnimFinish=function(){this.lose()},i.onAddRigidNode=function(e){this.colliderLayer.addChild(e),e.layer=this.colliderLayer.layer},i.onRemoveDynamicBarrier=function(e){this.removeDynamicBarrier(e)},i.onRemoveBreakBarrier=function(e){this.removeBreakBarrier(e)},i.onAddBreakAnim=function(e){this.addBreakAnim(e)},i.onRemoveBreakAnim=function(e){this.removeBreakAnim(e)},i.onDropGold=function(e){var t=n(),i=n();i.x=e.p.x,i.y=1,i.z=e.p.z;for(var a=0,r=6.28/e.count;a<6.28;a+=r)t.x=.08*Math.cos(a),t.y=12,t.z=.08*Math.sin(a),this.addGold({p:i,speed:t})},i.onAddGoldColler=function(e){C.addObj(e,u.CollerType.props)},i.onGetGold=function(){this.addGradeGold()},i.onRemoveGold=function(e){this.removeGold(e)},i.onAddAtkBox=function(e){this.addAtkBox(e)},i.onRemoveAtkBox=function(e){this.removeAtkBox(e)},i.onPlayerKillEnemy=function(){this.addGradeKilled()},i.onEnemyDead=function(e){var t=this;this.removeEnemy(e),this.emit(p.LevelEvent.updateRemainEnemy,this.allEnemies.length),this.player&&0==this.allEnemies.length&&(this.emit(p.Common.CtrlEvent.ctrlEnd),this.emit(p.Common.AudioEvent.stopBGM),setTimeout((function(){t.emit(p.Common.AudioEvent.playEffect,u.AudioClip.win)}),500),this.player.playWinAnim(),this.enterCustomUpdateState(u.LevelState.win),this.camera.changeCamera({duration:.3,pos:n(0,2.7,5.6),angle:n(-20,0,0),cb:function(){t.win(t.getResultData())}}))},i.onAddDeadBody=function(e){this.addDeadAnim(e)},i.onDeadAnimFinish=function(e){this.removeDeadAnim(e)},i.onAddScanBox=function(e){this.addScanBox(e)},i.onAddParticle=function(e){this.addParticle(e)},i.onDecideSkin=function(){var e=m.getData("gameData.WeaponSkin"),t=e.cur;e.try.type!==u.WeaponType.none&&0!==e.try.id&&(t=e.try);var i=m.getCurSkinId("PlayerSkin");this.player.changeSkin({weaponType:t.type,weaponId:t.id,skin:i}),this.enterCustomUpdateState(u.LevelState.fighting)},i.onDoorOpened=function(e){var t=e.curRole;t.isPlayer&&t.jumpInPortal(e.node.position,e.nextDoor.node.getPosition())},i.onPortalOpened=function(e){var t=this.portalPairs[e.portalId];t&&(e.closeDoor(),t.role.jumpInPortal(e.node.position,e.nextDoor.node.position))},i.onPlayerJumpInPortalFinish=function(){this.enterCustomUpdateState(u.LevelState.portalplayer)},d(t,[{key:"paused",get:function(){return this.isPaused}}]),t}(g)).prototype,"playerLayer",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),j=r(N.prototype,"camera",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=r(N.prototype,"mapLayer",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=r(N.prototype,"portalLayer",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),K=r(N.prototype,"staticBarrierLayer",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Q=r(N.prototype,"dynamicBarrierLayer",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Y=r(N.prototype,"breakBarrierLayer",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),J=r(N.prototype,"breakAnimLayer",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=r(N.prototype,"goldLayer",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=r(N.prototype,"bodyLayer",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),X=r(N.prototype,"roleLayer",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Z=r(N.prototype,"weaponStreakLayer",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$=r(N.prototype,"scanBoxLayer",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ee=r(N.prototype,"boomLayer",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),te=r(N.prototype,"particleLayer",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ie=r(N.prototype,"trapperLayer",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=N))||F));t._RF.pop()}}}));

System.register("chunks:///_virtual/AIManager.ts",["cc","./_rollupPluginModLoBabelHelpers.js","./GameEventType.ts","./EventManager.ts","./GlobalEnum.ts","./GlobalData2.ts"],(function(t){"use strict";var e,i,n,o,s,a,r,u,l;return{setters:[function(t){e=t.cclegacy,i=t.director,n=t.Vec2},function(t){o=t.defineProperty,s=t.createClass},function(t){a=t.EventType},function(t){r=t.default},function(t){u=t.GlobalEnum},function(t){l=t.default}],execute:function(){e._RF.push({},"a775adN3xVBkIrlR5qXz3GG","AIManager",void 0);var h=t("default",function(){function t(){}return t.init=function(){this.allAi={},this.onEvents()},t.onEvents=function(){r.on(a.LevelEvent.enemyAtkFinish,this.onEnemyAtkFinish,this),r.on(a.LevelEvent.enemyHitSuccess,this.onEnemyHitSuccess,this),r.on(a.LevelEvent.enemyJumpInPortal,this.onEnemyJumpInPortal,this),r.on(a.LevelEvent.enemyJumpOutPortalFinish,this.onEnemyJumpOutPortalFinish,this)},t.reset=function(){for(var t in this.allAi)c.put(this.allAi[t]);this.allAi={}},t.addEnemy=function(t){var e=t.Id;this.allAi[e]=c.get(t)},t.removeEnemy=function(t){var e=this.allAi[t.Id];e&&(c.put(e),delete this.allAi[t.Id])},t.enterLevel=function(){for(var t in this.allAi)this.allAi[t].enterLevel()},t.customUpdate=function(t){for(var e in this.allAi)this.allAi[e].customUpdate(t)},t.onEnemyAtkFinish=function(t){this.allAi[t.Id]&&this.allAi[t.Id].onAtkEnd()},t.onEnemyHitSuccess=function(t){this.allAi[t.Id]&&this.allAi[t.Id].onHitSuccess()},t.onEnemyJumpInPortal=function(t){this.allAi[t.Id]&&this.allAi[t.Id].onJumpInPortal()},t.onEnemyJumpOutPortalFinish=function(t){this.allAi[t.Id]&&this.allAi[t.Id].onJumpOutPortalFinish()},t}());o(h,"allAi",{});var c=function(){function t(){}return t.get=function(t){if(this.pool.length>0){var e=this.pool.pop();return e.reuse(t),e}var i=new m;return i.init(t),i},t.put=function(t){t.unuse(),this.pool.push(t)},t}();o(c,"pool",[]);var p,m=function(){function t(){o(this,"player",null),o(this,"role",null),o(this,"collGroundTime",0),o(this,"_customUpdateState",void 0),o(this,"customUpdateMap",void 0),o(this,"customStep",void 0),o(this,"cachePos",new n),o(this,"moveElapsed",0),o(this,"lastAtkTime",0)}var e=t.prototype;return e.init=function(t){this.initCustomUpdateState(),this.setRole(t),this.registAllCustomUpdate()},e.registAllCustomUpdate=function(){this.registCustomUpdate(p.atking,this.stepAtking),this.registCustomUpdate(p.moveFree,this.stepMoveFree),this.registCustomUpdate(p.moveToAtk,this.stepMoveToAtk),this.registCustomUpdate(p.runAway,this.stepRunAway)},e.reset=function(){this.role=null,this.player=null,this.resetCustomUpdateState()},e.unuse=function(){this.offColliderEvents(),this.reset()},e.reuse=function(t){this.setRole(t)},e.enterLevel=function(){this.onColliderEvents();var t=l.get(u.myGlobalDataType.player);this.player=t;var e=this.role.faceRadian;this.moveRadian(e),this.enterCustomUpdateState(p.moveFree),this.lastAtkTime=i.getCurrentTime()},e.setRole=function(t){this.role=t},e.onColliderEvents=function(){this.role&&this.role.onCollCb(this.onConcatBegin,this)},e.offColliderEvents=function(){this.role&&this.role.offCollCb(this.onConcatBegin,this)},e.onConcatBegin=function(t,e,i){switch(e.group){case u.RigidGroup.default:this.onCollBarrier();break;case u.RigidGroup.enmey:this.onCollRole();break;case u.RigidGroup.ground:this.onCollGround();break;case u.RigidGroup.player:this.player&&this.player.isAlive?this.onCollRole():this.moveRadian(this.role.faceRadian+3.14)}},e.onCollBarrier=function(){Math.random()<.7&&i.getCurrentTime()-this.lastAtkTime>4e3?this.startAtk():i.getCurrentTime()-this.collGroundTime>1e3&&this.moveRadian(6.28*Math.random())},e.onCollGround=function(){i.getCurrentTime()-this.collGroundTime>1e3&&this.moveRadian(6.28*Math.random())},e.onCollRole=function(){this.startAtk()},e.stepEmpty=function(t){},e.initCustomUpdateState=function(){this._customUpdateState=null,this.customStep=this.stepEmpty,this.customUpdateMap={}},e.resetCustomUpdateState=function(){this._customUpdateState=null,this.customStep=this.stepEmpty},e.registCustomUpdate=function(t,e){this.customUpdateMap||(this.customUpdateMap={}),this.customUpdateMap[t]=e},e.enterCustomUpdateState=function(t){this._customUpdateState!=t&&(this._customUpdateState=t,this.customUpdateMap[t]?this.customStep=this.customUpdateMap[t]:this.customStep=this.stepEmpty)},e.customUpdate=function(t){this.customStep&&this.customStep(t)},e.stepAtking=function(t){},e.stepMoveFree=function(t){this.moveElapsed+=t,this.moveElapsed>2?(this.moveElapsed=0,this.moveRadian(6.28*Math.random())):i.getCurrentTime()-this.lastAtkTime>5e3&&(this.checkAtkPlayer()||this.checkAtkEnemy())},e.checkAtkPlayer=function(){if(!this.player||!this.player.isAlive)return!1;var t=.25*this.role.atkRadiusSqr,e=this.player.node.position;return!!this.checkInAtkScope(e,t)&&(this.startAtk(),!0)},e.checkAtkEnemy=function(){for(var t=this.role.atkRadiusSqr+1,e=l.get(u.myGlobalDataType.enemies),i=e.length-1;i>=0;--i)if(e[i].Id!=this.role.Id){var n=e[i].node.position;if(this.checkInAtkScope(n,t))return this.startAtk(),!0}return!1},e.checkInAtkScope=function(t,e){var i=this.role.node.position,n=this.cachePos;if(n.x=t.x-i.x,n.y=i.z-t.z,n.x*n.x+n.y*n.y>e)return!1;var o=this.role.speed;return n.x*o.x-n.y*o.z>0},e.stepMoveToAtk=function(t){},e.stepRunAway=function(t){},e.stepPortal=function(t){},e.startAtk=function(){this.lastAtkTime=i.getCurrentTime(),this.role.startAtk(),this.enterCustomUpdateState(p.atking)},e.moveDir=function(t,e){this.role.setMoveDir(t,e)},e.moveRadian=function(t){this.role.setMoveRadian(t),this.collGroundTime=i.getCurrentTime()},e.onStartAtk=function(){},e.onAtkEnd=function(){var t=6.28*Math.random();this.moveRadian(t),this.moveElapsed=0,this.enterCustomUpdateState(p.moveFree)},e.onBeHit=function(){},e.onHitSuccess=function(){},e.onJumpInPortal=function(){this.enterCustomUpdateState(p.portal)},e.onJumpOutPortalFinish=function(){var t=this.role.faceRadian;this.moveRadian(t),this.moveElapsed=0,this.enterCustomUpdateState(p.moveFree)},s(t,[{key:"customUpdateState",get:function(){return this._customUpdateState}}]),t}();!function(t){t[t.atking=0]="atking",t[t.moveFree=1]="moveFree",t[t.runAway=2]="runAway",t[t.moveToAtk=3]="moveToAtk",t[t.portal=4]="portal"}(p||(p={})),e._RF.pop()}}}));

System.register("chunks:///_virtual/LevelCamera.ts",["cc","./_rollupPluginModLoBabelHelpers.js","./GameConfig.ts","./GameEventType.ts","./GlobalEnum.ts","./Action3dManager.ts","./yyComponent.ts"],(function(e){"use strict";var i,t,s,a,o,n,l,r,c,h,u,d,p,g,f,v,m;return{setters:[function(e){i=e.cclegacy,t=e.Camera,s=e.Node,a=e._decorator,o=e.v3,n=e.v2},function(e){l=e.applyDecoratedDescriptor,r=e.inheritsLoose,c=e.initializerDefineProperty,h=e.assertThisInitialized,u=e.defineProperty},function(e){d=e.default},function(e){p=e.EventType},function(e){g=e.GlobalEnum},function(e){f=e.default,v=e.ActionMngType},function(e){m=e.default}],execute:function(){var S,y,P,x,_,M,w,k;i._RF.push({},"ade43+9RZtE46LoF1vdxOuA","LevelCamera",void 0);var C=a,D=C.ccclass,E=C.property;e("default",(S=E(t),y=E(s),P=E(s),D((M=l((_=function(e){function i(){for(var i,t=arguments.length,s=new Array(t),a=0;a<t;a++)s[a]=arguments[a];return i=e.call.apply(e,[this].concat(s))||this,c(h(i),"camera",M,h(i)),c(h(i),"cameraNode",w,h(i)),c(h(i),"anchorNode",k,h(i)),u(h(i),"_originalPos",void 0),u(h(i),"__originalPos",void 0),u(h(i),"_originalEulerAngles",void 0),u(h(i),"shakeElapsed",0),u(h(i),"shakeDuration",.3),u(h(i),"shakeRadius",.1),u(h(i),"shaking",!1),u(h(i),"normalScale",void 0),u(h(i),"maxScale",void 0),u(h(i),"scaleElapsed",void 0),u(h(i),"scaleDuration",void 0),u(h(i),"scaleCenter",void 0),u(h(i),"scaleStay",void 0),u(h(i),"scaleBackDuration",void 0),u(h(i),"followTarget",void 0),u(h(i),"cachePos",void 0),u(h(i),"viewScope",void 0),u(h(i),"offsetScope",void 0),u(h(i),"cameraDis",0),i}r(i,e);var s=i.prototype;return s.init=function(){this.anchorNode=this.node,this.camera=this.node.getComponentInChildren(t),this.cameraNode=this.camera.node,this.initCameraDis(),this.initFollowState(),this.initScaleData(),this.initOriginalTransform(),this.initCustomUpdateState(),this.registAllCustomUpdate(),this.onEvents()},s.registAllCustomUpdate=function(){this.registCustomUpdate(g.LevelCameraState.follow,this.stepSlowFollow)},s.onEvents=function(){this.on(p.LevelEvent.shakeScreen,this.shake,this),this.on(p.LevelEvent.scaleScreen,this.scaleScreen,this),this.on(p.LevelEvent.updateRoleScale,this.onUpdateRoleScale,this)},s.reset=function(){this.followTarget=null,this.stopScaleScreen(),this.resetScaleData(),this.stopShake(),this.resumeOriginalTransform()},s.enterLevel=function(){this.enterCustomUpdateState(g.LevelCameraState.follow)},s.initOriginalTransform=function(){this._originalPos=o(),this.cameraNode.getPosition(this._originalPos),this.__originalPos=o(),this.__originalPos.set(this._originalPos),this._originalEulerAngles=o(),this._originalEulerAngles.set(this.cameraNode.eulerAngles)},s.resumeOriginalTransform=function(e,i){if(void 0===e&&(e=0),this._originalPos.set(this.__originalPos),!e)return this.cameraNode.setPosition(this._originalPos),void(this.cameraNode.eulerAngles=this._originalEulerAngles);this.changeCamera({duration:e,pos:this._originalPos,angle:this._originalEulerAngles,cb:i})},s.changeCamera=function(e){if(!e.duration)return e.pos&&this.cameraNode.setPosition(e.pos),e.angle&&(this.cameraNode.eulerAngles=e.angle),void(e.cb&&e.cb());var i=null,t=null;e.pos&&(i=f.moveTo(e.duration,e.pos)),e.angle&&(t=f.rotateTo(e.duration,e.angle));var s=null;i&&t?s=f.spawn(i,t):i?s=f.spawn(i):t&&(s=f.spawn(t));var a=f.getMng(v.Level);if(s&&e.cb){var o=f.callFun(e.cb),n=f.sequence(s,o);a.runAction(this.cameraNode,n)}else s?a.runAction(this.cameraNode,s):e.cb&&e.cb()},s.moveTo=function(e,i,t){if(0==e)return this.node.setPosition(i),void(t&&t());var s=f.getMng(v.Level),a=f.moveTo(e,i);if(a.easing(f.easeOut(3)),t){var o=f.callFun(t);s.runAction(this.node,f.sequence(a,o))}else s.runAction(this.node,a)},s.shake=function(e){if(void 0===e&&(e={}),this.shakeElapsed=0,this.shakeDuration=e.duration||.3,this.shakeRadius=e.radius||.1,!this.shaking){this.stopScaleScreen();var i=f.thread(this.randomCameraPos,this);f.getMng(v.Level).runAction(this,i),this.shaking=!0}},s.randomCameraPos=function(e){if(this.shakeElapsed+=e,this.shakeElapsed>=this.shakeDuration)this.stopShake();else{var i=this.shakeRadius*(1-this.shakeElapsed/this.shakeDuration),t=6.28*Math.random(),s=Math.sin(t)*i,a=Math.cos(t)*i;this.cameraNode.setPosition(this._originalPos.x+s,this._originalPos.y+a,this._originalPos.z)}},s.stopShake=function(){this.shakeElapsed=0,this.shaking=!1,this.cameraNode.setPosition(this._originalPos),f.getMng(v.Level).stopAllActions(this)},s.shock=function(e){this.stopShake();var i=this._originalPos;this.cameraNode.setPosition(i.x+e.offset.x,i.y+e.offset.y,i.z+e.offset.z);var t=f.moveTo(e.duration,i);f.getMng(v.Level).runAction(this.cameraNode,t)},s.stopShock=function(){f.getMng(v.Level).stopAllActions(this.cameraNode)},s.initScaleData=function(){this.normalScale=1,this.maxScale=1.5,this.scaleElapsed=0,this.scaleDuration=.1,this.scaleStay=.1,this.scaleCenter=n(),this.scaleBackDuration=0},s.resetScaleData=function(){this.scaleElapsed=0},s.scaleScreen=function(e){this.stopShake(),this.maxScale=e.maxScale||1.5,e.center?(this.scaleCenter.x=e.center.x-this.node.position.x,this.scaleCenter.y=e.center.y-this.node.position.y):(this.scaleCenter.x=0,this.scaleCenter.y=0),this.scaleDuration=e.duration||.1,this.scaleStay=e.stay||.1,this.scaleElapsed=0,this.scaleBackDuration=e.scaleBackDuration||0;var i=f.thread(this.threadScaleScreen,this);f.getMng(v.Level).runAction(this,i)},s.threadScaleScreen=function(e){if(this.scaleElapsed+=e,this.scaleElapsed>this.scaleDuration+this.scaleStay+this.scaleBackDuration)this.stopScaleScreen();else if(this.scaleElapsed<=this.scaleDuration){var i=this.scaleElapsed/this.scaleDuration,t=this.normalScale+(this.maxScale-this.normalScale)*i,s=this.scaleCenter.x-this.scaleCenter.x/t,a=this.scaleCenter.y-this.scaleCenter.y/t;this.cameraNode.setPosition(s,a)}else if(this.scaleElapsed>this.scaleDuration+this.scaleStay){var o=(this.scaleElapsed-this.scaleDuration-this.scaleStay)/this.scaleBackDuration,n=this.maxScale-(this.maxScale-this.normalScale)*o,l=this.scaleCenter.x-this.scaleCenter.x/n,r=this.scaleCenter.y-this.scaleCenter.y/n;this.cameraNode.setPosition(l,r)}},s.stopScaleScreen=function(){this.cameraNode.setPosition(this._originalPos),f.getMng(v.Level).stopAllActions(this)},s.initFollowState=function(){this.followTarget=null,this.cachePos=o(),this.viewScope={xMin:-100,xMax:100,yMin:-100,yMax:100},this.offsetScope={xMin:-100,xMax:100,yMin:0,yMax:100}},s.setViewScope=function(e,i,t,s){this.viewScope.xMin=e,this.viewScope.xMax=i,this.viewScope.yMin=t,this.viewScope.yMax=s},s.setOffsetScope=function(e,i,t,s){this.offsetScope.xMin=e,this.offsetScope.xMax=i,this.offsetScope.yMin=t,this.offsetScope.yMax=s},s.setTarget=function(e){this.followTarget=e,this.anchorNode.getPosition(this.cachePos)},s.stepSlowFollow=function(e){this.followTarget&&this.anchorNode.setPosition(this.followTarget.position.x,0,this.followTarget.position.z)},s.clampView=function(){this.cachePos.x<this.viewScope.xMin?this.cachePos.x=this.viewScope.xMin:this.cachePos.x>this.viewScope.xMax&&(this.cachePos.x=this.viewScope.xMax),this.cachePos.y<this.viewScope.yMin?this.cachePos.y=this.viewScope.yMin:this.cachePos.y>this.viewScope.yMax&&(this.cachePos.y=this.viewScope.yMax)},s.initCameraDis=function(){var e=this.cameraNode.position;this.cameraDis=e.length()},s.onUpdateRoleScale=function(e){var i=(this.cameraDis+25*(e-d.GameRule.minScale))/this.cameraDis;this._originalPos.x=this.__originalPos.x*i,this._originalPos.y=this.__originalPos.y*i,this._originalPos.z=this.__originalPos.z*i;var t=f.moveTo(1,this._originalPos);f.getMng(v.Level).runAction(this.cameraNode,t)},i}(m)).prototype,"camera",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=l(_.prototype,"cameraNode",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=l(_.prototype,"anchorNode",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=_))||x));i._RF.pop()}}}));

System.register("chunks:///_virtual/CollerManager.ts",["cc","./_rollupPluginModLoBabelHelpers.js","./GlobalEnum.ts","./QuadTree.ts","./LevelColler.ts"],(function(e){"use strict";var l,t,r,n,s;return{setters:[function(e){l=e.cclegacy},function(e){t=e.defineProperty},function(e){r=e.GlobalEnum},function(e){n=e.default},function(e){s=e.default}],execute:function(){l._RF.push({},"bf8abSmOZ1PYK7OX2E1m9EV","CollerManager",void 0);var o=e("default",function(){function e(){}return e.init=function(){this.allTrees={},this.allTrees[r.CollerType.barrier]=new n(0,100,0,100,7,5),this.allTrees[r.CollerType.role]=new n(0,100,0,100,7,5),this.allTrees[r.CollerType.props]=new n(0,100,0,100,7,5)},e.setTreeScope=function(e,l,t,r){for(var n in this.allTrees)this.allTrees[n].init(e,l,t,r,7,5)},e.reset=function(){for(var e in this.allTrees)this.allTrees[e].reset()},e.addObjs=function(e,l){for(var t=this.allTrees[l],r=e.length-1;r>=0;--r)t.insertObj(e[r])},e.addObj=function(e,l){this.allTrees[l].insertObj(e)},e.removeObjs=function(e,l){for(var t=this.allTrees[l],r=e.length-1;r>=0;--r)t.removeObj(e[r])},e.removeObj=function(e,l){this.allTrees[l].removeObj(e)},e.checkColl=function(e,l){for(var t=e.getAABB(),r=this.allTrees[l].getObjs(e),n=r.length-1;n>=0;--n)s.checkAABB(t,r[n].getAABB())&&(e.onColled(r[n]),r[n].onColled(e))},e.getCollers=function(e,l){return this.allTrees[l].getObjs(e)},e.getScopeCollers=function(e,l){return this.allTrees[l].getObjsByAABB(e)},e}());t(o,"allTrees",void 0),l._RF.pop()}}}));

System.register("chunks:///_virtual/LevelScene",["./LevelManager.ts","./LevelCamera.ts","./AIManager.ts","./CollerManager.ts","./MyLevelManager.ts"],(function(){"use strict";return{setters:[null,null,null,null,null],execute:function(){}}}));

(function(r) {
  r('virtual:///prerequisite-imports/LevelScene', 'chunks:///_virtual/LevelScene'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});